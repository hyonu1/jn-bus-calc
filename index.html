<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>yeobi-easy for JNE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Pretendard & SUIT Fonts */
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        @import url('https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css');
        
        :root {
            --font-suit: 'SUIT', sans-serif;
            --font-pretendard: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            --color-teal: #00BFA5;
            --color-bg-card: #F7F9FB;
            --color-text-main: #191F28;
        }

        body { 
            font-family: var(--font-pretendard);
            background-color: #FFFFFF;
            color: var(--color-text-main);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            overscroll-behavior-y: none;
        }

        .font-suit { font-family: var(--font-suit); }
        .font-pretendard { font-family: var(--font-pretendard); }
        .font-gmarket { font-family: 'GmarketSans', sans-serif; }
        
        @font-face { font-family: 'GmarketSans'; font-weight: 700; src: local('Gmarket Sans Bold'), url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansBold.woff') format('woff'); font-display: swap; }

        .text-teal-startup { color: var(--color-teal); }
        .bg-teal-startup { background-color: var(--color-teal); }
        .bg-card-startup { background-color: var(--color-bg-card); }

        .main-wrapper { max-width: 480px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; background-color: #FFFFFF; }

        .input-group:focus-within { border-color: var(--color-teal); background-color: #FFFFFF; box-shadow: 0 0 0 4px rgba(0, 191, 165, 0.1); }
        .btn-primary { background-color: var(--color-teal); color: white; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-primary:active { transform: scale(0.98); background-color: #00A891; }
        .result-card { background-color: var(--color-bg-card); border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02); }

        .wipe-container { display: grid; grid-template-columns: 1fr; position: relative; overflow: hidden; border-radius: 16px; touch-action: pan-y; }
        .wipe-layer { grid-row: 1; grid-column: 1; width: 100%; min-height: 100%; }
        .wipe-base { z-index: 1; background-color: var(--color-bg-card); }
        .wipe-overlay { z-index: 2; background-color: #FFFFFF; transition: clip-path 0.5s cubic-bezier(0.25, 1, 0.5, 1), transform 0.5s cubic-bezier(0.25, 1, 0.5, 1); clip-path: inset(0 0 0 100%); transform: translateX(20px); }
        .wipe-overlay.active { clip-path: inset(0 0 0 0); transform: translateX(0); }

        @keyframes slideUpModal { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up-modal { animation: slideUpModal 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes pulse-scale { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .animate-pulse-scale { animation: pulse-scale 2s ease-in-out infinite; }
        @keyframes pulse-attention { 0%, 100% { transform: scale(1); box-shadow: 0 4px 12px rgba(0, 191, 165, 0.2); } 50% { transform: scale(1.03); box-shadow: 0 0 0 4px rgba(0, 191, 165, 0.15); } }
        .animate-pulse-attention { animation: pulse-attention 2.5s infinite cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fade-in-calm { from { opacity: 0; transform: translateY(2px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-calm { animation: fade-in-calm 0.6s ease-out forwards; }
        
        @keyframes wiggle { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } }
        .icon-wiggle { display: inline-block; animation: wiggle 1.5s ease-in-out infinite; transform-origin: bottom center; margin-left: 4px; font-style: normal; }
        @keyframes float-boat { 0%, 100% { transform: translateY(0) rotate(0deg); } 25% { transform: translateY(1px) rotate(1deg); } 50% { transform: translateY(-2px) rotate(0deg); } 75% { transform: translateY(1px) rotate(-1deg); } }
        .ship-body { animation: float-boat 3s ease-in-out infinite; transform-origin: center bottom; }

        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #E5E8EB; border-radius: 4px; }
        
        input.ship-fare-input { text-align: right; border-bottom: 1px solid #E5E8EB; background-color: transparent; width: 80px; font-family: var(--font-suit); font-weight: 700; color: #191F28; outline: none; padding-bottom: 2px; transition: all 0.2s; -moz-appearance: textfield; appearance: none; }
        input.ship-fare-input:focus { border-color: var(--color-teal); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CHOSUNG = ["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
        const COMPLEX_JAMO_MAP = {'ã„³':'ã„±ã……','ã„µ':'ã„´ã…ˆ','ã„¶':'ã„´ã…','ã„º':'ã„¹ã„±','ã„»':'ã„¹ã…','ã„¼':'ã„¹ã…‚','ã„½':'ã„¹ã……','ã„¾':'ã„¹ã…Œ','ã„¿':'ã„¹ã…','ã…€':'ã„¹ã…','ã…„':'ã…‚ã……'};

        const getChosung = (str) => {
            if (!str) return "";
            let result = "";
            for (let i = 0; i < str.length; i++) {
                const code = str.charCodeAt(i) - 44032;
                if (code > -1 && code < 11172) result += CHOSUNG[Math.floor(code / 588)];
                else result += str.charAt(i);
            }
            return result;
        };
        const resolveComplexJamo = (str) => !str ? "" : str.split('').map(char => COMPLEX_JAMO_MAP[char] || char).join('');
        const normalize = (text) => text ? text.replace(/(ì‹œ|êµ°|ì|ë©´|í„°ë¯¸ë„|ì¢…í•©|ê³µìš©|\s)/g, "") : "";
        const fmt = (num) => (num !== undefined && num !== null) ? num.toLocaleString() : '0';

        // --- Data Definitions ---
        const ALLOWED_CITIES = [
            "ê´‘ì£¼", "ë‚¨ì•…", "ëª©í¬", "ì—¬ìˆ˜", "ìˆœì²œ", "ë‚˜ì£¼", "ê´‘ì–‘", "ë‹´ì–‘", "ê³¡ì„±", "êµ¬ë¡€", "ê³ í¥", "ë³´ì„±",
            "í™”ìˆœ", "ì¥í¥", "ê°•ì§„", "í•´ë‚¨", "ì˜ì•”", "ë¬´ì•ˆ", "í•¨í‰", "ì˜ê´‘", "ì¥ì„±", "ì™„ë„", "ì§„ë„", "ì‹ ì•ˆ",
            "ì••í•´", "ì§€ë„", "ì¦ë„", "ì„ì", "íŒ”ê¸ˆ", "ì•”íƒœ", "ìì€", "ì•ˆì¢Œ", "ì¥ì‚°", "í•˜ì˜", "ì‹ ì˜", 
            "í‘ì‚°", "ë¹„ê¸ˆ", "ë„ì´ˆ", "í™ë„", "ê°€ê±°ë„", "ë§Œì¬ë„", "ì²­ì‚°", "ë…¸í™”", "ì†Œì•ˆ", "ì—¬ì„œë„", "ê¸ˆì¼", 
            "ìƒì¼", "ë³´ê¸¸", "ê¸ˆë‹¹", "êµ°ì™¸", "ì‹ ì§€", "ê³ ê¸ˆ", "ì•½ì‚°", "ê´€ë§¤ë„", "ì¡°ë„", "ì„œê±°ì°¨ë„",
            "ë“ëŸ‰ë„", "ì‘¥ì„¬(ì• ë„)", "ì•ˆë§ˆë„", "ë‚™ì›”", "ì†¡ì´ë„", "ì¥ë„", "ì–´ë£¡ë„"
        ];

        const REGION_ICONS = {
            "ê´‘ì£¼": "ğŸ‰", "ëª©í¬": "âš“", "ì—¬ìˆ˜": "ğŸ¤", "ìˆœì²œ": "ğŸŒ¾", "ë‚˜ì£¼": "ğŸ", "ê´‘ì–‘": "âš½", "ë‹´ì–‘": "ğŸ‹", "ê³¡ì„±": "ğŸš‚", "êµ¬ë¡€": "ğŸ»", "ê³ í¥": "ğŸš€", "ë³´ì„±": "ğŸµ", "í™”ìˆœ": "ğŸª¨", "ì¥í¥": "ğŸ„", "ê°•ì§„": "ğŸº", "í•´ë‚¨": "ğŸ¦–", "ì˜ì•”": "ğŸï¸", "ë¬´ì•ˆ": "ğŸ§…", "í•¨í‰": "ğŸ¦‹", "ì˜ê´‘": "ğŸŸ", "ì¥ì„±": "ğŸ‚", "ì™„ë„": "ğŸ¦ª", "ì§„ë„": "ğŸ•", "ì‹ ì•ˆ": "ğŸª½", "ë‚¨ì•…": "ğŸ›ï¸", 
            "ì§€ë„": "ğŸ§‚", "ì••í•´": "ğŸ™", "ì¦ë„": "ğŸš²", "ì„ì": "ğŸŒ·", "ìì€": "ğŸ–ï¸", "ì•ˆì¢Œ": "ğŸ˜ˆ", "íŒ”ê¸ˆ": "ğŸ¦", "ì•”íƒœ": "ğŸŒ", "ë¹„ê¸ˆ": "ğŸ¦…", "ë„ì´ˆ": "ğŸŒ¿", "í‘ì‚°": "ğŸŸ", "í•˜ì˜": "ğŸ•Šï¸", "ì‹ ì˜": "ğŸ§‚", "ì¥ì‚°": "ğŸ”ï¸",
            "í™ë„": "ğŸŒ…", "ê°€ê±°ë„": "ğŸï¸", "ë§Œì¬ë„": "ğŸ£",
            "ì²­ì‚°": "ğŸŒ", "ë…¸í™”": "ğŸ¦ª", "ì†Œì•ˆ": "ğŸ‡°ğŸ‡·", "ì—¬ì„œë„": "ğŸ£", "ê¸ˆì¼": "ğŸŒŠ", "ìƒì¼": "ğŸ‚", "ë³´ê¸¸": "ğŸ“œ",
            "ê¸ˆë‹¹": "ğŸ—¿", "êµ°ì™¸": "ğŸŒ‰", "ì‹ ì§€": "ğŸ–ï¸", "ê³ ê¸ˆ": "ğŸš¢", "ì•½ì‚°": "ğŸ",
            "ê´€ë§¤ë„": "ğŸŒ²", "ì¡°ë„": "ğŸ¦…", "ì„œê±°ì°¨ë„": "ğŸš¢",
            "ë“ëŸ‰ë„": "ğŸŒ¾", "ì‘¥ì„¬(ì• ë„)": "ğŸ±", "ì•ˆë§ˆë„": "ğŸ", "ë‚™ì›”": "ğŸŒ™", "ì†¡ì´ë„": "ğŸš", "ì¥ë„": "ğŸï¸", "ì–´ë£¡ë„": "ğŸ‰"
        };

        const ISLAND_DB = {
            "ì••í•´": { hub: "ëª©í¬", cost: 1000, type: "connected", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ì§€ë„": { hub: "ëª©í¬", cost: 1000, type: "connected", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ì¦ë„": { hub: "ëª©í¬", cost: 1000, type: "connected", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ì„ì": { hub: "ëª©í¬", cost: 1000, type: "connected", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "íŒ”ê¸ˆ": { hub: "ëª©í¬", cost: 1000, type: "connected", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ì•”íƒœ": { hub: "ëª©í¬", cost: 1000, type: "connected", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ìì€": { hub: "ëª©í¬", cost: 1000, type: "connected", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ì•ˆì¢Œ": { hub: "ëª©í¬", cost: 1000, type: "connected", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ë¹„ê¸ˆ": { hub: "ëª©í¬", via: "ëª©í¬, ì•”íƒœ", cost: 2000, type: "ship", special: true, sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ì¥ì‚°": { hub: "ëª©í¬", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "í•˜ì˜": { hub: "ëª©í¬", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ì‹ ì˜": { hub: "ëª©í¬", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "í‘ì‚°": { hub: "ëª©í¬", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ë„ì´ˆ": { hub: "ëª©í¬", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "í™ë„": { hub: "ëª©í¬", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ê°€ê±°ë„": { hub: "ëª©í¬", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ë§Œì¬ë„": { hub: "ëª©í¬", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì‹ ì•ˆêµ° ì¡°ë¡€"] },
            "ì™„ë„": { hub: "ì™„ë„", cost: 0, type: "connected", special: true }, 
            "êµ°ì™¸": { hub: "ì™„ë„", cost: 0, type: "connected", special: true }, // êµ°ì™¸ is handled as Wando with 0 cost
            "ì‹ ì§€": { hub: "ì™„ë„", cost: 0, type: "connected", special: true },
            "ê³ ê¸ˆ": { hub: "ì™„ë„", cost: 0, type: "connected", special: true },
            "ì•½ì‚°": { hub: "ì™„ë„", cost: 0, type: "connected", special: true },
            "ì²­ì‚°": { hub: "ì™„ë„", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì™„ë„êµ° ì¡°ë¡€"] },
            "ë…¸í™”": { hub: "ì™„ë„", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì™„ë„êµ° ì¡°ë¡€"] },
            "ë³´ê¸¸": { hub: "ì™„ë„", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì™„ë„êµ° ì¡°ë¡€"] },
            "ì†Œì•ˆ": { hub: "ì™„ë„", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì™„ë„êµ° ì¡°ë¡€"] },
            "ì—¬ì„œë„": { hub: "ì™„ë„", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì™„ë„êµ° ì¡°ë¡€"] },
            "ê¸ˆì¼": { hub: "ì™„ë„", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì™„ë„êµ° ì¡°ë¡€"] },
            "ìƒì¼": { hub: "ì™„ë„", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì™„ë„êµ° ì¡°ë¡€"] },
            "ì¡°ë„": { hub: "ì§„ë„", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì§„ë„êµ° ì¡°ë¡€"] },
            "ê´€ë§¤ë„": { hub: "ì§„ë„", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì§„ë„êµ° ì¡°ë¡€"] },
            "ì„œê±°ì°¨ë„": { hub: "ì§„ë„", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì§„ë„êµ° ì¡°ë¡€"] },
            "ë“ëŸ‰ë„": { hub: "ê³ í¥", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì „ë¼ë‚¨ë„ ì¡°ë¡€"] },
            "ì‘¥ì„¬(ì• ë„)": { hub: "ê³ í¥", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì „ë¼ë‚¨ë„ ì¡°ë¡€"] },
            "ì•ˆë§ˆë„": { hub: "ì˜ê´‘", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì „ë¼ë‚¨ë„ ì¡°ë¡€"] },
            "ë‚™ì›”": { hub: "ì˜ê´‘", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì „ë¼ë‚¨ë„ ì¡°ë¡€"] },
            "ì†¡ì´ë„": { hub: "ì˜ê´‘", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì „ë¼ë‚¨ë„ ì¡°ë¡€"] },
            "ê¸ˆë‹¹": { hub: "ì¥í¥", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì „ë¼ë‚¨ë„ ì¡°ë¡€"] },
            "ì–´ë£¡ë„": { hub: "í•´ë‚¨", cost: 1000, type: "ship", sources: ["ì„œê²½ì¢…@ì••í•´ì´ˆ", "ì „ë¼ë‚¨ë„ ì¡°ë¡€"] }
        };

        const POPUP_REGIONS = {
            "ì‹ ì•ˆ": ["ì§€ë„", "ì••í•´", "ì¦ë„", "ì„ì", "ìì€", "ì•ˆì¢Œ", "íŒ”ê¸ˆ", "ì•”íƒœ", "ë¹„ê¸ˆ", "ë„ì´ˆ", "í‘ì‚°", "í•˜ì˜", "ì‹ ì˜", "ì¥ì‚°", "í™ë„", "ê°€ê±°ë„", "ë§Œì¬ë„"],
            "ì™„ë„": ["ì™„ë„", "ê¸ˆì¼", "ë…¸í™”", "êµ°ì™¸", "ì‹ ì§€", "ê³ ê¸ˆ", "ì•½ì‚°", "ì²­ì‚°", "ì†Œì•ˆ", "ê¸ˆë‹¹", "ë³´ê¸¸", "ìƒì¼", "ì—¬ì„œë„"],
            "ì§„ë„": ["ì§„ë„", "ì¡°ë„", "ê´€ë§¤ë„", "ì„œê±°ì°¨ë„"]
        };

        const Icons = {
            MapPin: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Search: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            ArrowRight: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
            Info: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>,
            X: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Bus: (props) => (
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                    <path d="M8 6v6" /><path d="M15 6v6" /><path d="M2 12h19.6" /><path d="M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3" /><circle cx="7" cy="18" r="2" /><path d="M9 18h5" /><circle cx="16" cy="18" r="2" />
                </svg>
            ),
            Ticket: (props) => (
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                    <path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v14"/><path d="M8 5v14"/>
                </svg>
            ),
            Globe: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>,
            Database: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
            Calculator: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
        };

        const Toggle = ({ checked, onChange }) => (
            <button onClick={() => onChange(!checked)} className={`w-11 h-6 rounded-full transition-colors relative ${checked ? 'bg-teal-500' : 'bg-gray-200'}`}>
                <span className={`absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform ${checked ? 'translate-x-5' : 'translate-x-0'}`} />
            </button>
        );

        const AutocompleteInput = ({ value, onChange, onSelect, placeholder, label, cityList, onEnter, onShowModal }) => {
            const [suggestions, setSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [activeIndex, setActiveIndex] = useState(-1);
            const inputRef = useRef(null);

            useEffect(() => {
                const inputVal = (value || '').trim();
                if (!inputVal || cityList.includes(inputVal)) { setSuggestions([]); return; }
                
                const resolved = resolveComplexJamo(inputVal);
                const isChosung = /^[ã„±-ã…]+$/.test(resolved); 
                
                if (isChosung && resolved.length < 2) { setSuggestions([]); return; }

                let exact = cityList.filter(city => {
                    if (isChosung) {
                         return getChosung(city).includes(resolved);
                    } else {
                        return city.includes(inputVal);
                    }
                });

                setSuggestions(exact.length > 0 ? exact : []);
            }, [value, cityList]);

            const handleSelect = (city) => {
                onSelect(city);
                setShowSuggestions(false);
                setSuggestions([]);
            };

            const handleKeyDown = (e) => {
                if (e.key === 'ArrowDown') { e.preventDefault(); if (suggestions.length > 0) setActiveIndex(prev => (prev < suggestions.length - 1 ? prev + 1 : 0)); }
                else if (e.key === 'ArrowUp') { e.preventDefault(); if (suggestions.length > 0) setActiveIndex(prev => (prev > 0 ? prev - 1 : suggestions.length - 1)); }
                else if (e.key === 'Enter') {
                    if (e.nativeEvent.isComposing) return;
                    const trimmedValue = (value || '').trim();
                    if (cityList.includes(trimmedValue)) { onSelect(trimmedValue); if(onEnter) onEnter(); setShowSuggestions(false); e.target.blur(); return; }
                    
                    if (activeIndex >= 0) handleSelect(suggestions[activeIndex]);
                    else if (suggestions.length > 0) handleSelect(suggestions[0]);
                    else onSelect(value);
                    
                    if(onEnter) onEnter();
                    setShowSuggestions(false);
                    e.target.blur();
                }
            };

            return (
                <div className={`relative group ${showSuggestions ? 'z-50' : 'z-20'}`}>
                    <div className="input-group bg-card-startup rounded-2xl p-4 flex items-center gap-3">
                        <Icons.MapPin className="text-gray-400 group-focus-within:text-teal-startup transition-colors" size={20} />
                        <div className="flex-1">
                            <label className="block text-xs font-semibold text-gray-400 mb-1 font-pretendard tracking-wide">{label}</label>
                            <input ref={inputRef} type="text" className="w-full bg-transparent outline-none font-suit font-bold text-gray-800 text-lg placeholder-gray-300" placeholder={placeholder} value={value || ''} onChange={e => { onChange(e.target.value); setShowSuggestions(true); }} onFocus={() => setShowSuggestions(true)} onBlur={() => setTimeout(() => setShowSuggestions(false), 200)} onKeyDown={handleKeyDown} autoComplete="off" />
                        </div>
                    </div>
                    {showSuggestions && suggestions.length > 0 && (
                        <div className="absolute left-0 right-0 top-full mt-2 bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden z-50">
                            <ul className="custom-scroll max-h-60 overflow-y-auto">
                                {suggestions.map((city, idx) => (
                                    <li key={city} onClick={() => handleSelect(city)} onMouseEnter={() => setActiveIndex(idx)} className={`px-5 py-3 text-sm font-medium cursor-pointer flex justify-between items-center ${idx === activeIndex ? 'bg-teal-50 text-teal-700' : 'text-gray-600 hover:bg-gray-50'}`}><span className="font-pretendard">{city}</span><span className="text-lg">{REGION_ICONS[city]}</span></li>
                                ))}
                            </ul>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [origin, setOrigin] = useState('');
            const [destination, setDestination] = useState('');
            const [result, setResult] = useState(null);
            const [busDataState, setBusDataState] = useState({});
            const [modalState, setModalState] = useState({ type: null, data: [] });
            const [showDetail, setShowDetail] = useState(false);
            const [shipFare, setShipFare] = useState(0); 
            const [customTransport, setCustomTransport] = useState('');
            const [manualMainTransport, setManualMainTransport] = useState(null); 
            const [intraDeductions, setIntraDeductions] = useState({ shortTime: false, govVehicle: false });
            const [activeModal, setActiveModal] = useState(null); 
            const [deductions, setDeductions] = useState({ gov_vehicle: false, meal_1: false, meal_2: false, meal_3: false, meal_half: false, transport_proof: false, transport_gov_vehicle: false, transport_passenger: false });

            const touchStartX = useRef(null);
            const touchEndX = useRef(null);
            const onTouchStart = (e) => { touchStartX.current = e.targetTouches[0].clientX; };
            const onTouchMove = (e) => { touchEndX.current = e.targetTouches[0].clientX; };
            const onTouchEnd = () => {
                if (!touchStartX.current || !touchEndX.current) return;
                const distance = touchStartX.current - touchEndX.current;
                const isLeftSwipe = distance > 50;
                const isRightSwipe = distance < -50;
                if (isLeftSwipe && !showDetail && result) setShowDetail(true);
                if (isRightSwipe && showDetail) setShowDetail(false);
                touchStartX.current = null;
                touchEndX.current = null;
            };

            const MODAL_CONTENT = {
                daily: { title: "ì¼ë¹„", desc: `ì¶œì¥ì§€(${destination || 'ë„ì°©ì§€ëª…'}) ë‚´ì—ì„œ ì†Œìš”ë˜ëŠ” êµí†µë¹„, í†µì‹ ë¹„, ìŒë£Œë¹„ ë“±`, items: [ { id: 'gov_vehicle', label: "ê´€ìš©ì°¨ëŸ‰ ì´ìš© : ì¼ë¹„ì˜ Â½ ê°ì•¡", subLabel: "(ì„ì°¨ë²„ìŠ¤, í†µí•™ë²„ìŠ¤ ë“±)" } ] },
                meal: { title: "ì‹ë¹„", desc: "ì‹ì‚¬ì— ì†Œìš”ë˜ëŠ” ë¹„ìš©(ì´í•˜ ê°ì•¡ ì‚¬ìœ )", reasons: [ "ì—°ìˆ˜, í˜‘ì˜íšŒ, í–‰ì‚¬ ì£¼ìµœ ì¸¡ì—ì„œ ì‹ì‚¬ ì œê³µ", "ì˜ˆì‚°(ê³„ì•½)ìœ¼ë¡œ ì‹ë¹„ê°€ ì´ë¯¸ ì§€ì¶œ", "ì—…ë¬´ì¶”ì§„ë¹„ë¡œ ì‹ì‚¬ë¥¼ í•´ê²°í•œ ê²½ìš°", { text: "ì¤‘ë³µì§€ê¸‰ ë°©ì§€", sub: ( <div className="flex text-gray-500 mt-0.5"><span className="shrink-0">ì˜ˆ)</span><div className="ml-1">ì˜¤ì „ ê´€ë‚´ ì¶œì¥ê³¼ ì˜¤í›„ ê´€ì™¸ ì¶œì¥ì´ ê²¹ì¹˜ëŠ” ê²½ìš°,<br/>í†µìƒì ì¸ ì‹ì‚¬ ì‹œê°„ê³¼ ì¶œì¥ ì‹œê°„ì„ ê³ ë ¤,<br/>ê´€ì™¸ ì¶œì¥ ì‹ë¹„ì˜ Â½ ë˜ëŠ” â…”ë¥¼ ê°ì•¡í•˜ì—¬ ì§€ê¸‰.</div></div> ) } ], items: [ { id: 'meal_1', label: "1ì‹ ê°ì•¡" }, { id: 'meal_2', label: "2ì‹ ê°ì•¡" }, { id: 'meal_3', label: "ì „ì•¡ ê°ì•¡" }, { id: 'meal_half', label: "Â½ ê°ì•¡" } ] },
                transport: { title: "êµí†µë¹„", desc: `ë„ì°©ì§€(${destination || 'ë„ì°©ì§€ëª…'})ë¡œ ì´ë™í•˜ê¸° ìœ„í•œ ìœ¡ìƒ êµí†µìˆ˜ë‹¨ì˜ ë¹„ìš©`, subDesc: ( <span><span className="font-bold text-gray-700">ì£¼ìœ ì˜ìˆ˜ì¦(ì¶œì¥ì§€)</span>, <span className="font-bold text-gray-700">í†µí–‰ì˜ìˆ˜ì¦(í•˜ì´íŒ¨ìŠ¤)</span>, ìŠ¹ì°¨ê¶Œ, ì‹ ìš©ì¹´ë“œë§¤ì¶œì „í‘œ ë“±</span> ), items: [ { id: 'transport_proof', label: "ì¦ê±°ì„œë¥˜ì˜ ë¯¸ì œì¶œ/ë¶€ì ì •" }, { id: 'transport_gov_vehicle', label: "ê³µìš©ì°¨ëŸ‰ì´ë‚˜ ì„ì°¨ì°¨ëŸ‰ ì´ìš©í•œ ê²½ìš°" }, { id: 'transport_passenger', label: "ë™ë£Œì˜ ì°¨ëŸ‰ì— ë™ìŠ¹í•œ ê²½ìš°", subLabel: "ë™ìŠ¹ìì—ê²ŒëŠ” êµí†µë¹„ë¥¼ ì§€ê¸‰í•˜ì§€ ì•ŠìŒ" } ] }
            };

            const toggleDeduction = (id) => {
                setDeductions(prev => {
                    const newState = { ...prev };
                    if (['meal_1', 'meal_2', 'meal_3', 'meal_half'].includes(id)) { if (!prev[id]) { newState['meal_1'] = false; newState['meal_2'] = false; newState['meal_3'] = false; newState['meal_half'] = false; } }
                    newState[id] = !prev[id];
                    if (id === 'gov_vehicle') newState['transport_gov_vehicle'] = newState[id];
                    if (id === 'transport_gov_vehicle') newState['gov_vehicle'] = newState[id];
                    return newState;
                });
            };

            useEffect(() => {
                const INITIAL_DATA = {
                    "ê´‘ì£¼": { "ëª©í¬": { gen: 7200, pre: 9300 }, "ì—¬ìˆ˜": { gen: 13000, pre: 16800 }, "ìˆœì²œ": { gen: 8400, pre: 11000 }, "ë‚˜ì£¼": { gen: 4300 }, "ê´‘ì–‘": { gen: 8400, pre: 10900 }, "ë‹´ì–‘": { gen: 2900 }, "ê³¡ì„±": { gen: 5500 }, "êµ¬ë¡€": { gen: 9800 }, "ê³ í¥": { gen: 16200, pre: 21000 }, "ë³´ì„±": { gen: 10500, pre: 11500 }, "í™”ìˆœ": { gen: 2500 }, "ì¥í¥": { gen: 11500, pre: 14900 }, "ê°•ì§„": { gen: 11700, pre: 15200 }, "í•´ë‚¨": { gen: 13700, pre: 16900 }, "ì˜ì•”": { gen: 8700 }, "ì˜ì•”(ë…ì²œ)": { gen: 7700 }, "ë¬´ì•ˆ": { gen: 6000, pre: 7800 }, "í•¨í‰": { gen: 4500, pre: 5800 }, "ì˜ê´‘": { gen: 7300, pre: 9500 }, "ì¥ì„±": { gen: 2400 }, "ì™„ë„": { gen: 20500, pre: 24800 }, "ì§„ë„": { gen: 15300, pre: 19900 }, "ë‚¨ì•…": { gen: 7200, pre: 9300 } },
                    "ëª©í¬": { "ê´‘ì£¼": { gen: 7200, pre: 9300 }, "ì—¬ìˆ˜": { gen: 16500, pre: 21400 }, "ìˆœì²œ": { gen: 11500, pre: 15000 }, "ë‚˜ì£¼": { gen: 7300 }, "ê´‘ì–‘": { gen: 13700, pre: 17800 }, "ë‹´ì–‘": { gen: 10100 }, "ê³¡ì„±": { gen: 12700 }, "êµ¬ë¡€": { gen: 17000 }, "ê³ í¥": { gen: 18600 }, "ë³´ì„±": { gen: 13500 }, "í™”ìˆœ": { gen: 9700 }, "ì¥í¥": { gen: 10200 }, "ê°•ì§„": { gen: 7800 }, "í•´ë‚¨": { gen: 8700 }, "ì˜ì•”": { gen: 6400 }, "ë¬´ì•ˆ": { gen: 3200 }, "í•¨í‰": { gen: 5100 }, "ì˜ê´‘": { gen: 8700 }, "ì¥ì„±": { gen: 9600 }, "ì™„ë„": { gen: 15700 }, "ì§„ë„": { gen: 8300, pre: 10800 }, "ë‚¨ì•…": { gen: 1700 } },
                    "ì—¬ìˆ˜": { "ê´‘ì£¼": { gen: 13000, pre: 16800 }, "ëª©í¬": { gen: 16500, pre: 21400 }, "ìˆœì²œ": { gen: 5000 }, "ë‚˜ì£¼": { gen: 17300 }, "ê´‘ì–‘": { gen: 7500 }, "ë‹´ì–‘": { gen: 15900 }, "ê³¡ì„±": { gen: 18500 }, "êµ¬ë¡€": { gen: 10200 }, "ê³ í¥": { gen: 13600 }, "ë³´ì„±": { gen: 12800 }, "í™”ìˆœ": { gen: 15500 }, "ì¥í¥": { gen: 16100 }, "ê°•ì§„": { gen: 18500 }, "í•´ë‚¨": { gen: 21500 }, "ì˜ì•”": { gen: 22400 }, "ë¬´ì•ˆ": { gen: 19000 }, "í•¨í‰": { gen: 17500 }, "ì˜ê´‘": { gen: 20300 }, "ì¥ì„±": { gen: 15400 }, "ì™„ë„": { gen: 28200 }, "ì§„ë„": { gen: 24800 }, "ë‚¨ì•…": { gen: 15600, pre: 20200 } },
                    "ìˆœì²œ": { "ê´‘ì£¼": { gen: 8400, pre: 11000 }, "ëª©í¬": { gen: 11500, pre: 15000 }, "ì—¬ìˆ˜": { gen: 5000 }, "ë‚˜ì£¼": { gen: 12700 }, "ê´‘ì–‘": { gen: 2500 }, "ë‹´ì–‘": { gen: 10100 }, "ê³¡ì„±": { gen: 9400 }, "êµ¬ë¡€": { gen: 5200 }, "ê³ í¥": { gen: 8700 }, "ë³´ì„±": { gen: 7900 }, "í™”ìˆœ": { gen: 9700 }, "ì¥í¥": { gen: 11100 }, "ê°•ì§„": { gen: 13500 }, "í•´ë‚¨": { gen: 16600 }, "ì˜ì•”": { gen: 17500 }, "ë¬´ì•ˆ": { gen: 14700, pre: 18200 }, "í•¨í‰": { gen: 12900 }, "ì˜ê´‘": { gen: 15700 }, "ì¥ì„±": { gen: 10800 }, "ì™„ë„": { gen: 23200 }, "ì§„ë„": { gen: 23900 }, "ë‚¨ì•…": { gen: 10600, pre: 13800 } },
                    "ë‚˜ì£¼": { "ê´‘ì£¼": { gen: 4300 }, "ëª©í¬": { gen: 7300 }, "ì—¬ìˆ˜": { gen: 17300 }, "ìˆœì²œ": { gen: 12700 }, "ê´‘ì–‘": { gen: 12700 }, "ë‹´ì–‘": { gen: 7200 }, "ê³¡ì„±": { gen: 9800 }, "êµ¬ë¡€": { gen: 14100 }, "ê³ í¥": { gen: 20500 }, "ë³´ì„±": { gen: 14800 }, "í™”ìˆœ": { gen: 6800 }, "ì¥í¥": { gen: 9000 }, "ê°•ì§„": { gen: 8200 }, "í•´ë‚¨": { gen: 9900 }, "ì˜ì•”": { gen: 4400 }, "ë¬´ì•ˆ": { gen: 4100 }, "í•¨í‰": { gen: 3700 }, "ì˜ê´‘": { gen: 7400 }, "ì¥ì„±": { gen: 6700 }, "ì™„ë„": { gen: 16600 }, "ì§„ë„": { gen: 17200 }, "ë‚¨ì•…": { gen: 9000 } },
                    "ê´‘ì–‘": { "ê´‘ì£¼": { gen: 8400, pre: 10900 }, "ëª©í¬": { gen: 13700, pre: 17800 }, "ì—¬ìˆ˜": { gen: 7500 }, "ìˆœì²œ": { gen: 2500 }, "ë‚˜ì£¼": { gen: 12700 }, "ë‹´ì–‘": { gen: 11300 }, "ê³¡ì„±": { gen: 13900 }, "êµ¬ë¡€": { gen: 7700 }, "ê³ í¥": { gen: 10200 }, "ë³´ì„±": { gen: 9900 }, "í™”ìˆœ": { gen: 10900 }, "ì¥í¥": { gen: 13200 }, "ê°•ì§„": { gen: 15600 }, "í•´ë‚¨": { gen: 19100 }, "ì˜ì•”": { gen: 19500 }, "ë¬´ì•ˆ": { gen: 14400 }, "í•¨í‰": { gen: 12900 }, "ì˜ê´‘": { gen: 15700 }, "ì¥ì„±": { gen: 10800 }, "ì™„ë„": { gen: 25800 }, "ì§„ë„": { gen: 23400 }, "ë‚¨ì•…": { gen: 11700 } },
                    "ë‹´ì–‘": { "ê´‘ì£¼": { gen: 2900 }, "ëª©í¬": { gen: 10100 }, "ì—¬ìˆ˜": { gen: 15900 }, "ìˆœì²œ": { gen: 10100 }, "ë‚˜ì£¼": { gen: 11300 }, "ê´‘ì–‘": { gen: 11300 }, "ê³¡ì„±": { gen: 8400 }, "êµ¬ë¡€": { gen: 12700 }, "ê³ í¥": { gen: 19100 }, "ë³´ì„±": { gen: 13400 }, "í™”ìˆœ": { gen: 8000 }, "ì¥í¥": { gen: 14400 }, "ê°•ì§„": { gen: 14600 }, "í•´ë‚¨": { gen: 16600 }, "ì˜ì•”": { gen: 11600 }, "ë¬´ì•ˆ": { gen: 8900 }, "í•¨í‰": { gen: 7400 }, "ì˜ê´‘": { gen: 10200 }, "ì¥ì„±": { gen: 5300 }, "ì™„ë„": { gen: 23400 }, "ì§„ë„": { gen: 18200 }, "ë‚¨ì•…": { gen: 10100 } },
                    "ê³¡ì„±": { "ê´‘ì£¼": { gen: 5500 }, "ëª©í¬": { gen: 12700 }, "ì—¬ìˆ˜": { gen: 18500 }, "ìˆœì²œ": { gen: 9800 }, "ë‚˜ì£¼": { gen: 9800 }, "ê´‘ì–‘": { gen: 13900 }, "ë‹´ì–‘": { gen: 8400 }, "êµ¬ë¡€": { gen: 4300 }, "ê³ í¥": { gen: 21400 }, "ë³´ì„±": { gen: 17300 }, "í™”ìˆœ": { gen: 8000 }, "ì¥í¥": { gen: 17000 }, "ê°•ì§„": { gen: 17200 }, "í•´ë‚¨": { gen: 19200 }, "ì˜ì•”": { gen: 14200 }, "ë¬´ì•ˆ": { gen: 11500 }, "í•¨í‰": { gen: 8800 }, "ì˜ê´‘": { gen: 12800 }, "ì¥ì„±": { gen: 7900 }, "ì™„ë„": { gen: 23000 }, "ì§„ë„": { gen: 20800 }, "ë‚¨ì•…": { gen: 12700 } },
                    "êµ¬ë¡€": { "ê´‘ì£¼": { gen: 9800 }, "ëª©í¬": { gen: 17000 }, "ì—¬ìˆ˜": { gen: 10200 }, "ìˆœì²œ": { gen: 5200 }, "ë‚˜ì£¼": { gen: 14100 }, "ê´‘ì–‘": { gen: 7700 }, "ë‹´ì–‘": { gen: 12700 }, "ê³¡ì„±": { gen: 4300 }, "ê³ í¥": { gen: 13900 }, "ë³´ì„±": { gen: 13100 }, "í™”ìˆœ": { gen: 12300 }, "ì¥í¥": { gen: 16300 }, "ê°•ì§„": { gen: 18700 }, "í•´ë‚¨": { gen: 21800 }, "ì˜ì•”": { gen: 18500 }, "ë¬´ì•ˆ": { gen: 15800 }, "í•¨í‰": { gen: 14300 }, "ì˜ê´‘": { gen: 17100 }, "ì¥ì„±": { gen: 12200 }, "ì™„ë„": { gen: 28400 }, "ì§„ë„": { gen: 29100 }, "ë‚¨ì•…": { gen: 19000 } },
                    "ê³ í¥": { "ê´‘ì£¼": { gen: 16200, pre: 21000 }, "ëª©í¬": { gen: 18600 }, "ì—¬ìˆ˜": { gen: 13600 }, "ìˆœì²œ": { gen: 8700 }, "ë‚˜ì£¼": { gen: 20500 }, "ê´‘ì–‘": { gen: 10200 }, "ë‹´ì–‘": { gen: 19100 }, "ê³¡ì„±": { gen: 21400 }, "êµ¬ë¡€": { gen: 13900 }, "ë³´ì„±": { gen: 9900 }, "í™”ìˆœ": { gen: 13700 }, "ì¥í¥": { gen: 13100 }, "ê°•ì§„": { gen: 14200 }, "í•´ë‚¨": { gen: 18600 }, "ì˜ì•”": { gen: 19500 }, "ë¬´ì•ˆ": { gen: 22200 }, "í•¨í‰": { gen: 20700 }, "ì˜ê´‘": { gen: 23500 }, "ì¥ì„±": { gen: 18600 }, "ì™„ë„": { gen: 25200 }, "ì§„ë„": { gen: 25900 }, "ë‚¨ì•…": { gen: 23400 } },
                    "ë³´ì„±": { "ê´‘ì£¼": { gen: 10500, pre: 11500 }, "ëª©í¬": { gen: 13500 }, "ì—¬ìˆ˜": { gen: 12800 }, "ìˆœì²œ": { gen: 7900 }, "ë‚˜ì£¼": { gen: 14800 }, "ê´‘ì–‘": { gen: 9900 }, "ë‹´ì–‘": { gen: 13400 }, "ê³¡ì„±": { gen: 17300 }, "êµ¬ë¡€": { gen: 13100 }, "ê³ í¥": { gen: 9900 }, "í™”ìˆœ": { gen: 7800 }, "ì¥í¥": { gen: 3200 }, "ê°•ì§„": { gen: 5700 }, "í•´ë‚¨": { gen: 8700 }, "ì˜ì•”": { gen: 7800 }, "ë¬´ì•ˆ": { gen: 16700 }, "í•¨í‰": { gen: 15000 }, "ì˜ê´‘": { gen: 17800 }, "ì¥ì„±": { gen: 12900 }, "ì™„ë„": { gen: 15400 }, "ì§„ë„": { gen: 16000 }, "ë‚¨ì•…": { gen: 13500 } },
                    "í™”ìˆœ": { "ê´‘ì£¼": { gen: 2500 }, "ëª©í¬": { gen: 9700 }, "ì—¬ìˆ˜": { gen: 15500 }, "ìˆœì²œ": { gen: 9700 }, "ë‚˜ì£¼": { gen: 6800 }, "ê´‘ì–‘": { gen: 10900 }, "ë‹´ì–‘": { gen: 8000 }, "ê³¡ì„±": { gen: 8000 }, "êµ¬ë¡€": { gen: 12300 }, "ê³ í¥": { gen: 13700 }, "ë³´ì„±": { gen: 7800 }, "ì¥í¥": { gen: 10000 }, "ê°•ì§„": { gen: 11400 }, "í•´ë‚¨": { gen: 16500 }, "ì˜ì•”": { gen: 11200 }, "ë¬´ì•ˆ": { gen: 8500 }, "í•¨í‰": { gen: 7000 }, "ì˜ê´‘": { gen: 9800 }, "ì¥ì„±": { gen: 4900 }, "ì™„ë„": { gen: 23000 }, "ì§„ë„": { gen: 17800 }, "ë‚¨ì•…": { gen: 9700 } },
                    "ì¥í¥": { "ê´‘ì£¼": { gen: 11500, pre: 14900 }, "ëª©í¬": { gen: 10200 }, "ì—¬ìˆ˜": { gen: 16100 }, "ìˆœì²œ": { gen: 11100 }, "ë‚˜ì£¼": { gen: 9000 }, "ê´‘ì–‘": { gen: 13200 }, "ë‹´ì–‘": { gen: 14400 }, "ê³¡ì„±": { gen: 17000 }, "êµ¬ë¡€": { gen: 16300 }, "ê³ í¥": { gen: 13100 }, "ë³´ì„±": { gen: 3200 }, "í™”ìˆœ": { gen: 10000 }, "ê°•ì§„": { gen: 2400 }, "í•´ë‚¨": { gen: 5400 }, "ì˜ì•”": { gen: 4600 }, "ë¬´ì•ˆ": { gen: 8500 }, "í•¨í‰": { gen: 7000 }, "ì˜ê´‘": { gen: 9800 }, "ì¥ì„±": { gen: 4900 }, "ì™„ë„": { gen: 2300 }, "ì§„ë„": { gen: 12700 }, "ë‚¨ì•…": { gen: 9700 } },
                    "ê°•ì§„": { "ê´‘ì£¼": { gen: 11700, pre: 15200 }, "ëª©í¬": { gen: 7800 }, "ì—¬ìˆ˜": { gen: 18500 }, "ìˆœì²œ": { gen: 13500 }, "ë‚˜ì£¼": { gen: 8200 }, "ê´‘ì–‘": { gen: 12700 }, "ë‹´ì–‘": { gen: 14600 }, "ê³¡ì„±": { gen: 17200 }, "êµ¬ë¡€": { gen: 18700 }, "ê³ í¥": { gen: 14200 }, "ë³´ì„±": { gen: 5700 }, "í™”ìˆœ": { gen: 11400 }, "ì¥í¥": { gen: 2400 }, "í•´ë‚¨": { gen: 3000 }, "ì˜ì•”": { gen: 3900 }, "ë¬´ì•ˆ": { gen: 11000 }, "í•¨í‰": { gen: 11600 }, "ì˜ê´‘": { gen: 16500 }, "ì¥ì„±": { gen: 14100 }, "ì™„ë„": { gen: 7300 }, "ì§„ë„": { gen: 10300 }, "ë‚¨ì•…": { gen: 7600 } },
                    "í•´ë‚¨": { "ê´‘ì£¼": { gen: 13700, pre: 16900 }, "ëª©í¬": { gen: 8700 }, "ì—¬ìˆ˜": { gen: 21500 }, "ìˆœì²œ": { gen: 16600 }, "ë‚˜ì£¼": { gen: 9900 }, "ê´‘ì–‘": { gen: 19100 }, "ë‹´ì–‘": { gen: 16600 }, "ê³¡ì„±": { gen: 19200 }, "êµ¬ë¡€": { gen: 21800 }, "ê³ í¥": { gen: 18600 }, "ë³´ì„±": { gen: 8700 }, "í™”ìˆœ": { gen: 16500 }, "ì¥í¥": { gen: 5400 }, "ê°•ì§„": { gen: 3000 }, "ì˜ì•”": { gen: 4900 }, "ë¬´ì•ˆ": { gen: 11900 }, "í•¨í‰": { gen: 13800 }, "ì˜ê´‘": { gen: 17400 }, "ì¥ì„±": { gen: 16100 }, "ì™„ë„": { gen: 6700, pre: 8200 }, "ì§„ë„": { gen: 7300 }, "ë‚¨ì•…": { gen: 8500 } },
                    "ì˜ì•”": { "ê´‘ì£¼": { gen: 8700 }, "ëª©í¬": { gen: 6400 }, "ì—¬ìˆ˜": { gen: 22400 }, "ìˆœì²œ": { gen: 17500 }, "ë‚˜ì£¼": { gen: 4400 }, "ê´‘ì–‘": { gen: 19500 }, "ë‹´ì–‘": { gen: 11600 }, "ê³¡ì„±": { gen: 14200 }, "êµ¬ë¡€": { gen: 18500 }, "ê³ í¥": { gen: 19500 }, "ë³´ì„±": { gen: 7800 }, "í™”ìˆœ": { gen: 11200 }, "ì¥í¥": { gen: 4600 }, "ê°•ì§„": { gen: 3900 }, "í•´ë‚¨": { gen: 4900 }, "ë¬´ì•ˆ": { gen: 9600 }, "í•¨í‰": { gen: 7700 }, "ì˜ê´‘": { gen: 11800 }, "ì¥ì„±": { gen: 11100 }, "ì™„ë„": { gen: 11600 }, "ì§„ë„": { gen: 10300 }, "ë‚¨ì•…": { gen: 3700 } },
                    "ë¬´ì•ˆ": { "ê´‘ì£¼": { gen: 6000, pre: 7800 }, "ëª©í¬": { gen: 3200 }, "ì—¬ìˆ˜": { gen: 19000 }, "ìˆœì²œ": { gen: 14700, pre: 18200 }, "ë‚˜ì£¼": { gen: 4100 }, "ê´‘ì–‘": { gen: 14400 }, "ë‹´ì–‘": { gen: 8900 }, "ê³¡ì„±": { gen: 11500 }, "êµ¬ë¡€": { gen: 15800 }, "ê³ í¥": { gen: 22200 }, "ë³´ì„±": { gen: 16700 }, "í™”ìˆœ": { gen: 8500 }, "ì¥í¥": { gen: 13400 }, "ê°•ì§„": { gen: 11000 }, "í•´ë‚¨": { gen: 11900 }, "ì˜ì•”": { gen: 9600 }, "í•¨í‰": { gen: 2500 }, "ì˜ê´‘": { gen: 5500 }, "ì¥ì„±": { gen: 8400 }, "ì™„ë„": { gen: 18900 }, "ì§„ë„": { gen: 11500 }, "ë‚¨ì•…": { gen: 3700 } },
                    "í•¨í‰": { "ê´‘ì£¼": { gen: 4500, pre: 5800 }, "ëª©í¬": { gen: 5100 }, "ì—¬ìˆ˜": { gen: 17500 }, "ìˆœì²œ": { gen: 12900 }, "ë‚˜ì£¼": { gen: 3700 }, "ê´‘ì–‘": { gen: 12900 }, "ë‹´ì–‘": { gen: 7400 }, "ê³¡ì„±": { gen: 8800 }, "êµ¬ë¡€": { gen: 14300 }, "ê³ í¥": { gen: 20700 }, "ë³´ì„±": { gen: 15000 }, "í™”ìˆœ": { gen: 7000 }, "ì¥í¥": { gen: 15300 }, "ê°•ì§„": { gen: 11600 }, "í•´ë‚¨": { gen: 13800 }, "ì˜ì•”": { gen: 7700 }, "ë¬´ì•ˆ": { gen: 2500 }, "ì˜ê´‘": { gen: 3600 }, "ì¥ì„±": { gen: 6900 }, "ì™„ë„": { gen: 20800 }, "ì§„ë„": { gen: 13400 }, "ë‚¨ì•…": { gen: 6800 } },
                    "ì˜ê´‘": { "ê´‘ì£¼": { gen: 7300, pre: 9500 }, "ëª©í¬": { gen: 8700 }, "ì—¬ìˆ˜": { gen: 20300 }, "ìˆœì²œ": { gen: 15700 }, "ë‚˜ì£¼": { gen: 7400 }, "ê´‘ì–‘": { gen: 15700 }, "ë‹´ì–‘": { gen: 10200 }, "ê³¡ì„±": { gen: 12800 }, "êµ¬ë¡€": { gen: 17100 }, "ê³ í¥": { gen: 23500 }, "ë³´ì„±": { gen: 17800 }, "í™”ìˆœ": { gen: 9800 }, "ì¥í¥": { gen: 18900 }, "ê°•ì§„": { gen: 16500 }, "í•´ë‚¨": { gen: 17400 }, "ì˜ì•”": { gen: 11800 }, "ë¬´ì•ˆ": { gen: 5500 }, "í•¨í‰": { gen: 3600 }, "ì¥ì„±": { gen: 5900 }, "ì™„ë„": { gen: 24400 }, "ì§„ë„": { gen: 17000 }, "ë‚¨ì•…": { gen: 8700 } },
                    "ì¥ì„±": { "ê´‘ì£¼": { gen: 2400 }, "ëª©í¬": { gen: 9600 }, "ì—¬ìˆ˜": { gen: 10800 }, "ìˆœì²œ": { gen: 6700 }, "ë‚˜ì£¼": { gen: 10800 }, "ê´‘ì–‘": { gen: 5300 }, "ë‹´ì–‘": { gen: 7900 }, "ê³¡ì„±": { gen: 12200 }, "êµ¬ë¡€": { gen: 18600 }, "ê³ í¥": { gen: 12900 }, "ë³´ì„±": { gen: 4900 }, "í™”ìˆœ": { gen: 13900 }, "ì¥í¥": { gen: 14100 }, "ê°•ì§„": { gen: 16100 }, "í•´ë‚¨": { gen: 11100 }, "ì˜ì•”": { gen: 8400 }, "ë¬´ì•ˆ": { gen: 6900 }, "í•¨í‰": { gen: 5900 }, "ì˜ê´‘": { gen: 9700 }, "ì™„ë„": { gen: 22900 }, "ì§„ë„": { gen: 14000 }, "ë‚¨ì•…": { gen: 15500 } },
                    "ì™„ë„": { "ê´‘ì£¼": { gen: 20500, pre: 24800 }, "ëª©í¬": { gen: 15700 }, "ì—¬ìˆ˜": { gen: 28200 }, "ìˆœì²œ": { gen: 23200 }, "ë‚˜ì£¼": { gen: 16600 }, "ê´‘ì–‘": { gen: 25800 }, "ë‹´ì–‘": { gen: 23400 }, "ê³¡ì„±": { gen: 23000 }, "êµ¬ë¡€": { gen: 28400 }, "ê³ í¥": { gen: 25200 }, "ë³´ì„±": { gen: 15400 }, "í™”ìˆœ": { gen: 23000 }, "ì¥í¥": { gen: 12100 }, "ê°•ì§„": { gen: 7300 }, "í•´ë‚¨": { gen: 6700, pre: 8200 }, "ì˜ì•”": { gen: 11600 }, "ë¬´ì•ˆ": { gen: 18900 }, "í•¨í‰": { gen: 20800 }, "ì˜ê´‘": { gen: 22900 }, "ì¥ì„±": { gen: 22900 }, "ì§„ë„": { gen: 14000 }, "ë‚¨ì•…": { gen: 15500 } },
                    "ì§„ë„": { "ê´‘ì£¼": { gen: 15300, pre: 19900 }, "ëª©í¬": { gen: 8300, pre: 10800 }, "ì—¬ìˆ˜": { gen: 24800 }, "ìˆœì²œ": { gen: 23900 }, "ë‚˜ì£¼": { gen: 17200 }, "ê´‘ì–‘": { gen: 23400 }, "ë‹´ì–‘": { gen: 18200 }, "ê³¡ì„±": { gen: 20800 }, "êµ¬ë¡€": { gen: 29100 }, "ê³ í¥": { gen: 25900 }, "ë³´ì„±": { gen: 16000 }, "í™”ìˆœ": { gen: 17800 }, "ì¥í¥": { gen: 12700 }, "ê°•ì§„": { gen: 10300 }, "í•´ë‚¨": { gen: 7300 }, "ì˜ì•”": { gen: 10300 }, "ë¬´ì•ˆ": { gen: 11500 }, "í•¨í‰": { gen: 13400 }, "ì˜ê´‘": { gen: 17000 }, "ì¥ì„±": { gen: 17700 }, "ì™„ë„": { gen: 14000 }, "ë‚¨ì•…": { gen: 10100 } },
                    "ë‚¨ì•…": { "ê´‘ì£¼": { gen: 7200, pre: 9300 }, "ëª©í¬": { gen: 1700 }, "ì—¬ìˆ˜": { gen: 15600, pre: 20200 }, "ìˆœì²œ": { gen: 10600, pre: 13800 }, "ë‚˜ì£¼": { gen: 9000 }, "ê´‘ì–‘": { gen: 11700 }, "ë‹´ì–‘": { gen: 10100 }, "ê³¡ì„±": { gen: 12700 }, "êµ¬ë¡€": { gen: 19000 }, "ê³ í¥": { gen: 23400 }, "ë³´ì„±": { gen: 13500 }, "í™”ìˆœ": { gen: 9700 }, "ì¥í¥": { gen: 10000 }, "ê°•ì§„": { gen: 7600 }, "í•´ë‚¨": { gen: 8500 }, "ì˜ì•”": { gen: 3700 }, "ë¬´ì•ˆ": { gen: 3700 }, "í•¨í‰": { gen: 6800 }, "ì˜ê´‘": { gen: 8700 }, "ì¥ì„±": { gen: 9600 }, "ì™„ë„": { gen: 15500 }, "ì§„ë„": { gen: 10100 } } 
                };

                const expandedData = JSON.parse(JSON.stringify(INITIAL_DATA));
                Object.keys(INITIAL_DATA).forEach(from => {
                    Object.keys(INITIAL_DATA[from]).forEach(to => {
                        if (!expandedData[to]) expandedData[to] = {};
                        if (!expandedData[to][from]) expandedData[to][from] = INITIAL_DATA[from][to];
                    });
                });
                setBusDataState(expandedData);
            }, []);

            useEffect(() => {
                if (ALLOWED_CITIES.includes(origin) && ALLOWED_CITIES.includes(destination)) performCalculation(origin, destination);
            }, [origin, destination]);

            useEffect(() => { 
                if (POPUP_REGIONS[origin]) setModalState({ type: 'origin', data: POPUP_REGIONS[origin] }); 
            }, [origin]);
            
            useEffect(() => { 
                if (POPUP_REGIONS[destination]) setModalState({ type: 'destination', data: POPUP_REGIONS[destination] }); 
            }, [destination]);

            const handleModalSelect = (city) => {
                if (modalState.type === 'origin') setOrigin(city);
                else if (modalState.type === 'destination') setDestination(city);
                else if (modalState.type === 'selection') {
                    if (modalState.target === 'origin') setOrigin(city);
                    else if (modalState.target === 'destination') setDestination(city);
                }
                setModalState({ type: null, data: [] });
            };

            const performCalculation = (overOrigin, overDestination) => {
                const from = normalize(overOrigin || origin);
                const to = normalize(overDestination || destination);
                
                setDeductions({ gov_vehicle: false, meal_1: false, meal_2: false, meal_3: false, meal_half: false, transport_proof: false, transport_gov_vehicle: false, transport_passenger: false });
                setShipFare(0); setIntraDeductions({ shortTime: false, govVehicle: false }); setCustomTransport('');
                setManualMainTransport(null);

                if (!from || !to) return;
                if (Object.keys(busDataState).length === 0) return;

                if (!ALLOWED_CITIES.includes(from) || !ALLOWED_CITIES.includes(to)) {
                     setResult({ type: 'external', source: "ì™¸ë¶€ ê²€ìƒ‰ (ë„¤ì´ë²„ì§€ë„, ì¹´ì¹´ì˜¤ë§µ)", isShipOnlyRoute: false });
                     return;
                }

                if (from === to) {
                    setResult({ type: 'intraCity', short: 10000, long: 20000, note: "ê´€ë‚´ì—¬ë¹„ëŠ” êµí†µë¹„ì™€ ì‹ë¹„ ë“±ì„ í¬í•¨í•œ ì •ì•¡ìœ¼ë¡œ ì§€ê¸‰í•¨.\n(ì¡°ê±´ì— ë”°ë¼ -10,000ì› ì”© ê°ì•¡)" });
                    return;
                }
                
                const fromIsland = ISLAND_DB[from];
                const toIsland = ISLAND_DB[to];
                
                let searchFrom = from;
                let searchTo = to;
                let surcharge = 0;
                let viaPoint = null;
                let routeType = 'direct';
                let specialNote = null;
                let islandConfig = null;
                let note = "";
                let source = null;
                let isShipOnlyRoute = false;
                let isSpecialRoute = false;
                
                if (fromIsland) {
                    searchFrom = fromIsland.hub;
                    surcharge += fromIsland.cost;
                    islandConfig = fromIsland;
                    viaPoint = fromIsland.via || fromIsland.hub;
                    if(fromIsland.special) isSpecialRoute = true;
                }
                if (toIsland) {
                    searchTo = toIsland.hub;
                    surcharge += toIsland.cost;
                    islandConfig = toIsland; 
                    viaPoint = toIsland.via || toIsland.hub;
                    if(toIsland.special) isSpecialRoute = true;
                }
                
                if ((from === 'ëª©í¬' && to === 'ì••í•´') || (from === 'ì••í•´' && to === 'ëª©í¬')) {
                    setResult({ 
                        type: 'internal', 
                        data: { gen: 1200, pre: null, note: "ì‹ ì•ˆêµ°ë†ì–´ì´Œë²„ìŠ¤ ìš”ê¸ˆ ê°€ì‚°: 1,200ì›" }, 
                        routeType: 'direct', 
                        source: "ì‹ ì•ˆêµ°ì²­ í™ˆí˜ì´ì§€, ì‹œì™¸ë²„ìŠ¤ ì¸ê°€ë‚´ì—­ ë“±",
                        islandType: 'connected', surcharge: 0 
                    });
                    return;
                }

                const baseData = busDataState[searchFrom]?.[searchTo];
                
                if (baseData || (searchFrom === searchTo)) {
                    let finalGen = (baseData?.gen || 0);
                    let finalPre = (baseData?.pre || null);
                    
                    // Always add surcharge regardless of type (connected or ship)
                    // The user wanted the surcharge to be included in the displayed rate
                    finalGen += surcharge;
                    if (finalPre) finalPre += surcharge;

                    if (islandConfig) {
                        if (islandConfig.type === 'ship') {
                            routeType = 'transfer';
                            isShipOnlyRoute = true;
                            // Ship fare input remains separate for ADDITIONAL costs, 
                            // but the basic surcharge is now in finalGen
                        } else {
                            routeType = (searchFrom !== searchTo) ? 'transfer' : 'direct'; 
                            if (from === islandConfig.hub || to === islandConfig.hub) routeType = 'direct';
                        }
                        source = islandConfig.sources;
                    } else {
                        source = "2026.1.1.ì ì‹œêµ°ë³„ ì‹œì™¸ë²„ìŠ¤ìš”ê¸ˆ ì¸ê°€ë‚´ì—­";
                    }

                    const checkRoute = (a, b) => (from === a && to === b) || (from === b && to === a);
                    if (checkRoute('ëª©í¬', 'ì˜ì•”')) specialNote = "ë…ì²œí„°ë¯¸ë„ ì´ìš© ì‹œ 3,900ì›";
                    else if (checkRoute('ëª©í¬', 'ê´‘ì–‘')) specialNote = "ë™ê´‘ì–‘ì¤‘ë§ˆë²„ìŠ¤í„°ë¯¸ë„ ì´ìš© ì‹œ ìš°ë“± 20,100ì›/ì¼ë°˜ 15,500ì›";
                    else if (checkRoute('ê´‘ì£¼', 'ì˜ì•”')) specialNote = "ì§„ì›”ë™ì‹œì™¸ë²„ìŠ¤í„°ë¯¸ë„ ì´ìš© ì‹œ 7,700ì›";
                    else if (checkRoute('ê´‘ì–‘', 'ì—¬ìˆ˜')) specialNote = "ì´ìˆœì‹ ëŒ€êµë°©ë©´ ì´ìš© ì‹œ 5,600ì›";
                    else if (checkRoute('ìˆœì²œ', 'ê³¡ì„±')) specialNote = "ITX(ë„ì‹œê°„íŠ¹ê¸‰ì—´ì°¨) ì´ìš© ì‹œ 7,100ì›";

                    if (islandConfig && islandConfig.special) {
                        // For special islands, we still calculate based on finalGen which includes surcharge
                        const oneWay = finalPre ? finalPre : finalGen;
                        setManualMainTransport(oneWay * 2);
                    }

                    setResult({
                        type: 'internal',
                        data: { gen: finalGen, pre: finalPre, note },
                        routeType,
                        viaPoint,
                        specialNote,
                        source,
                        islandType: islandConfig?.type,
                        surcharge: islandConfig ? islandConfig.cost : 0,
                        isShipOnlyRoute,
                        isSpecial: islandConfig?.special 
                    });
                } else {
                    setResult({ type: 'external', source: "ì™¸ë¶€ ê²€ìƒ‰ (ë„¤ì´ë²„ì§€ë„, ì¹´ì¹´ì˜¤ë§µ)" });
                }
            };

            const calculateDetailedCost = () => {
                if (!result) return { daily: 0, meal: 0, transport: 0, total: 0 };
                
                if (result.type === 'intraCity') {
                    let total = 20000;
                    if (intraDeductions.shortTime) total -= 10000;
                    if (intraDeductions.govVehicle) total -= 10000;
                    return { daily: 0, meal: 0, transport: 0, total: Math.max(0, total) };
                }

                let daily = 25000;
                if (deductions.gov_vehicle) daily = 12500;

                let meal = 25000;
                if (deductions.meal_1) meal = 16660;
                else if (deductions.meal_2) meal = 8330;
                else if (deductions.meal_3) meal = 0;
                else if (deductions.meal_half) meal = 12500;

                let transport = 0;
                const isTransportDeducted = deductions.transport_proof || deductions.transport_gov_vehicle || deductions.transport_passenger;

                if (!isTransportDeducted) {
                    if (result.type === 'internal') {
                        if (result.isSpecial && manualMainTransport !== null) {
                            transport = Number(manualMainTransport);
                        } else {
                            let oneWayFare = result.data.pre ? result.data.pre : result.data.gen;
                            transport = oneWayFare * 2;
                        }
                    } else if (result.type === 'external') {
                        transport = Number(customTransport) || 0;
                    }
                } else {
                    transport = 0;
                }

                return {
                    daily,
                    meal,
                    transport,
                    total: daily + meal + transport + (shipFare || 0)
                };
            };

            const getTravelerText = () => {
                if (!origin || !destination) return "ì¶œì¥ìê°€";
                const originConfig = ISLAND_DB[origin];
                const destConfig = ISLAND_DB[destination];
                const config = originConfig || destConfig;

                if (!config) return "ì¶œì¥ìê°€";
                // Exception for Wando-connected (Gunoe, etc.)
                if (config.hub === 'ì™„ë„' && config.type === 'connected') return "ì¶œì¥ìê°€";
                
                if (config.type === 'connected') return "êµ°ë¯¼ì¸ ì¶œë°œìê°€";
                if (config.type === 'ship') return "ë„ì„œë¯¼ì¸ ì¶œë°œìê°€";
                return "ì¶œì¥ìê°€";
            };

            const detailCosts = calculateDetailedCost();
            const isTransportDeducted = deductions.transport_proof || deductions.transport_gov_vehicle || deductions.transport_passenger;
            const getDeductionBtnClass = (isActive) => `px-3 py-1.5 text-xs font-bold rounded-lg transition-all duration-300 active:scale-95 ${isActive ? 'bg-teal-500 text-white shadow-inner border border-transparent' : 'text-teal-700 bg-white border-2 border-teal-400 shadow-[0_2px_10px_rgba(0,191,165,0.2)] hover:bg-teal-50 hover:-translate-y-0.5 animate-pulse-attention relative overflow-hidden'}`;

            return (
                <div className="main-wrapper relative p-5">
                    {/* Active Modal */}
                    {activeModal && MODAL_CONTENT[activeModal] && (
                        <div className="fixed inset-0 z-[300] flex items-end justify-center sm:items-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200" onClick={() => setActiveModal(null)}>
                            <div className="bg-white w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl animate-slide-up-modal" onClick={e => e.stopPropagation()}>
                                <div className="p-6">
                                    <div className="flex justify-between items-start mb-2"><h3 className="font-bold font-suit text-xl text-gray-900">{MODAL_CONTENT[activeModal].title}</h3><button onClick={() => setActiveModal(null)} className="p-1 -mr-2 text-gray-400 hover:text-gray-600"><Icons.X size={20} /></button></div>
                                    <p className="text-sm text-gray-600 font-pretendard leading-relaxed mb-2 break-keep font-medium">{MODAL_CONTENT[activeModal].desc}</p>
                                    {MODAL_CONTENT[activeModal].subDesc && (<div className="mb-6 p-3 bg-gray-50 rounded-lg border border-gray-100/50"><p className="text-[11px] text-gray-400 font-pretendard leading-relaxed break-keep">{MODAL_CONTENT[activeModal].subDesc}</p></div>)}
                                    {activeModal === 'meal' && (<div className="mb-6 space-y-2 pl-1">{MODAL_CONTENT.meal.reasons.map((reason, idx) => (<div key={idx} className="flex items-start gap-2 text-sm text-gray-600 font-pretendard font-medium leading-relaxed"><span className="mt-2 w-1 h-1 rounded-full bg-gray-400 flex-shrink-0"></span><div className="leading-snug">{typeof reason === 'string' ? reason : (<><div>{reason.text}</div><div className="text-gray-400 text-xs mt-0.5 font-normal">{reason.sub}</div></>)}</div></div>))}</div>)}
                                    <div className={`${(activeModal !== 'meal' && !MODAL_CONTENT[activeModal].subDesc) ? 'mt-4' : ''} space-y-4`}>{MODAL_CONTENT[activeModal].items.map(item => (<div key={item.id} className="flex justify-between items-center py-3 border-b border-gray-100 last:border-0"><div className="pr-4"><span className="block text-sm font-bold text-gray-700 font-pretendard leading-tight">{item.label}</span>{item.subLabel && <span className="block text-xs text-gray-400 mt-1 font-pretendard">{item.subLabel}</span>}</div><Toggle checked={deductions[item.id]} onChange={() => toggleDeduction(item.id)} /></div>))}</div>
                                    <button onClick={() => setActiveModal(null)} className="w-full mt-6 py-3.5 bg-teal-startup text-white rounded-xl font-bold font-suit text-base shadow-md active:scale-95 transition-transform">í™•ì¸</button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Modal for City Selection */}
                    {modalState.type && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200">
                            <div className="bg-white rounded-2xl w-full max-w-sm overflow-hidden shadow-2xl">
                                <div className="bg-teal-startup p-4 flex items-center justify-between text-white"><h2 className="font-bold font-suit text-lg">ì§€ì—­ ì„ íƒ</h2><button onClick={() => setModalState({ type: null, data: [] })}><Icons.X size={20} /></button></div>
                                <div className="p-5 max-h-[60vh] overflow-y-auto custom-scroll">
                                    {(modalState.type === 'origin' || modalState.type === 'destination') && (
                                        <div className="grid grid-cols-3 gap-2">
                                            {modalState.data.map(name => (<button key={name} onClick={() => handleModalSelect(name)} className="flex items-center justify-between px-3 py-2.5 rounded-lg bg-gray-50 border border-gray-100 text-sm font-bold text-gray-700 hover:bg-teal-50 hover:text-teal-700 hover:border-teal-200 transition-all"><span>{name}</span>{REGION_ICONS[name] && <span className="text-lg icon-wiggle">{REGION_ICONS[name]}</span>}</button>))}
                                        </div>
                                    )}
                                    {modalState.type === 'selection' && (<div className="grid grid-cols-2 gap-2">{modalState.data.map(city => (<button key={city} onClick={() => handleModalSelect(city)} className="flex items-center justify-between px-4 py-3.5 rounded-xl bg-gray-50 border border-gray-100 text-sm font-bold text-gray-700 hover:bg-teal-50 hover:text-teal-700 hover:border-teal-200 transition-all"><span>{city}</span>{REGION_ICONS[city] && <span className="text-lg icon-wiggle">{REGION_ICONS[city]}</span>}</button>))}</div>)}
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="text-center mt-6 mb-8"><h1 className="text-2xl font-bold font-suit text-gray-900 tracking-tight">yeobi-easy for JNE</h1></div>

                    <div className="space-y-4 mb-6">
                        <AutocompleteInput label="ì¶œë°œì§€" placeholder="ì˜ˆ: ê´‘ì£¼, ã„±ã…ˆ" value={origin} onChange={setOrigin} onSelect={setOrigin} cityList={ALLOWED_CITIES} onEnter={() => { if(destination) performCalculation(); }} onShowModal={(data) => setModalState({ type: 'selection', data, target: 'origin' })} />
                        <AutocompleteInput label="ë„ì°©ì§€" placeholder="ì˜ˆ: í•´ë‚¨, ã…ã„´" value={destination} onChange={setDestination} onSelect={setDestination} cityList={ALLOWED_CITIES} onEnter={() => performCalculation()} onShowModal={(data) => setModalState({ type: 'selection', data, target: 'destination' })} />
                        <button onClick={() => performCalculation()} className="w-full h-14 rounded-2xl font-bold btn-primary text-base shadow-lg shadow-teal-100 flex items-center justify-center gap-2"><Icons.Search size={20} /> ì¡°íšŒí•˜ê¸°</button>
                    </div>

                    {result && (
                        <div className="mb-6 relative wipe-container" onTouchStart={onTouchStart} onTouchMove={onTouchMove} onTouchEnd={onTouchEnd}>
                            <div className="result-card p-6 wipe-layer wipe-base relative">
                                <a href="https://docs.google.com/spreadsheets/d/10v8CuQTEWWYuh-rGUDWfT3XmHShj3QP64bm8u0GFG4E/edit?usp=sharing" target="_blank" rel="noopener noreferrer" className="absolute top-4 left-4 w-12 h-12 bg-[#FFD700] text-white rounded-full shadow-md border border-white/20 flex flex-col items-center justify-center gap-0 z-20 hover:brightness-110 transition-all active:scale-95 animate-pulse-scale"><span className="text-[10px] font-bold leading-none text-yellow-900">ìš”ê¸ˆ</span><span className="text-[10px] font-bold leading-none mt-0.5 text-yellow-900">ì œë³´</span></a>
                                <button onClick={() => setShowDetail(true)} className="absolute top-4 right-4 w-12 h-12 bg-[#00BFA5] text-white rounded-full shadow-md border border-white/20 flex flex-col items-center justify-center gap-0 z-20 hover:brightness-110 transition-all active:scale-95 animate-pulse-scale"><span className="text-[11px] font-bold leading-none">ì—¬ë¹„</span><span className="text-[11px] font-bold leading-none mt-0.5">ê³„ì‚°</span></button>

                                <div className="flex items-center justify-center gap-3 mb-6 pb-6 border-b border-gray-200 border-dashed mt-4">
                                    <div className="flex items-center gap-1"><span className="font-semibold text-lg text-gray-900 font-pretendard">{origin}</span>{REGION_ICONS[origin] && <span className="text-lg inline-block ship-body">{REGION_ICONS[origin]}</span>}</div>
                                    <div className="flex flex-col items-center">
                                        {result.routeType === 'transfer' && (<span className="text-[10px] font-bold text-teal-600 bg-teal-50 px-2 py-0.5 rounded-full mb-1">{result.viaPoint} ê²½ìœ </span>)}
                                        <Icons.ArrowRight size={20} className="text-gray-300" />
                                    </div>
                                    <div className="flex items-center gap-1"><span className="font-semibold text-lg text-gray-900 font-pretendard">{destination}</span>{REGION_ICONS[destination] && <span className="text-lg inline-block ship-body">{REGION_ICONS[destination]}</span>}</div>
                                </div>

                                {result.type === 'intraCity' ? (
                                    <div className="space-y-3">
                                        <div className="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100 shadow-sm"><div className="flex items-center gap-2"><span className="text-sm font-medium text-gray-500 font-pretendard">4ì‹œê°„ ì´í•˜</span><button onClick={() => setIntraDeductions(prev => ({...prev, govVehicle: !prev.govVehicle}))} className={getDeductionBtnClass(intraDeductions.govVehicle)}>ê´€ìš©ì°¨ëŸ‰ ì´ìš©</button></div><span className="text-xl font-bold font-suit text-gray-900">{fmt(Math.max(0, result.short - (intraDeductions.govVehicle ? 10000 : 0)))}<span className="text-base font-medium text-gray-400 ml-1">ì›</span></span></div>
                                        <div className="flex items-center justify-between p-4 bg-teal-50 rounded-xl border border-teal-100 shadow-sm"><div className="flex items-center gap-2"><span className="text-sm font-medium text-teal-700 font-pretendard">4ì‹œê°„ ì´ìƒ</span><button onClick={() => setIntraDeductions(prev => ({...prev, govVehicle: !prev.govVehicle}))} className={getDeductionBtnClass(intraDeductions.govVehicle)}>ê´€ìš©ì°¨ëŸ‰ ì´ìš©</button></div><span className="text-2xl font-bold font-suit text-teal-600">{fmt(Math.max(0, result.long - (intraDeductions.govVehicle ? 10000 : 0)))}<span className="text-lg font-medium text-teal-400 ml-1">ì›</span></span></div>
                                        <div className="mt-4 flex items-start gap-2 bg-yellow-50 p-3 rounded-lg"><Icons.Info size={16} className="text-yellow-600 mt-0.5 flex-shrink-0" /><p className="text-xs text-yellow-700 font-pretendard leading-relaxed whitespace-pre-line">{result.note}</p></div>
                                    </div>
                                ) : result.type === 'internal' ? (
                                    <div className="space-y-3">
                                        <div className="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100 shadow-sm">
                                            <span className="text-sm font-medium text-gray-500 font-pretendard">ì¼ë°˜ ìš”ê¸ˆ</span>
                                            <div className="flex flex-col items-end gap-1">
                                                <div className="flex items-end">
                                                    <span className="text-2xl font-bold font-suit text-gray-900">{fmt(result.data.gen)}</span>
                                                    <span className="text-base font-medium font-suit text-gray-400 mb-0.5 ml-1">ì›</span>
                                                </div>
                                                {result.surcharge > 0 && (
                                                    <div className="flex items-center gap-1 px-2 py-1 bg-gray-50 rounded-lg border border-gray-100 animate-fade-in-calm">
                                                        {result.islandType === 'connected' ? <Icons.Bus size={12} className="text-teal-500" /> : <Icons.Ticket size={12} className="text-blue-500" />}
                                                        <span className={`text-xs font-bold ${result.islandType === 'connected' ? 'text-teal-600' : 'text-blue-600'}`}>
                                                            {result.isSpecial && result.islandType === 'ship' && result.surcharge === 2000 
                                                                ? "ë†ì–´ì´Œë²„ìŠ¤Â·ì—¬ê°ì„  2,000ì› í¬í•¨" 
                                                                : result.islandType === 'connected' 
                                                                    ? `ë†ì–´ì´Œë²„ìŠ¤ ${fmt(result.surcharge)}ì› í¬í•¨` 
                                                                    : `ì—¬ê°ì„  ${fmt(result.surcharge)}ì› í¬í•¨`}
                                                        </span>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                        {result.data.pre !== null && (
                                            <div className="flex items-center justify-between p-4 bg-teal-50 rounded-xl border border-teal-100 shadow-sm relative overflow-hidden">
                                                <span className="text-sm font-medium text-teal-700 font-pretendard relative z-10">ìš°ë“± ìš”ê¸ˆ</span>
                                                <div className="flex flex-col items-end gap-1 relative z-10">
                                                    <div className="flex items-end">
                                                        <span className="text-2xl font-bold font-suit text-teal-600">{fmt(result.data.pre)}</span>
                                                        <span className="text-base font-medium font-suit text-teal-400 mb-0.5 ml-1">ì›</span>
                                                    </div>
                                                    {result.surcharge > 0 && (
                                                        <div className="flex items-center gap-1 px-2 py-1 bg-white/50 rounded-lg border border-teal-100/50 animate-fade-in-calm">
                                                            {result.islandType === 'connected' ? <Icons.Bus size={12} className="text-teal-600" /> : <Icons.Ticket size={12} className="text-blue-600" />}
                                                            <span className={`text-xs font-bold ${result.islandType === 'connected' ? 'text-teal-700' : 'text-blue-700'}`}>
                                                                {result.isSpecial && result.islandType === 'ship' && result.surcharge === 2000 
                                                                    ? "ë†ì–´ì´Œë²„ìŠ¤Â·ì—¬ê°ì„  2,000ì› í¬í•¨" 
                                                                    : result.islandType === 'connected' 
                                                                        ? `ë†ì–´ì´Œë²„ìŠ¤ ${fmt(result.surcharge)}ì› í¬í•¨` 
                                                                        : `ì—¬ê°ì„  ${fmt(result.surcharge)}ì› í¬í•¨`}
                                                            </span>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div className="mt-4 p-4 bg-teal-50 border border-teal-100 rounded-xl text-left"><div className="space-y-2"><p className="text-xs text-teal-800 font-pretendard leading-relaxed"><span className="font-bold text-teal-600 mr-1">1.</span><span className="font-bold">êµí†µë¹„</span>Â·<span className="font-bold">ìˆ™ë°•ë¹„</span>ëŠ” ì‹¤ë¹„ì •ì‚°ì œ â†’ <span className="font-bold">ì¦ë¹™</span> ì—†ìœ¼ë©´ ì •ì‚° Ã—</p><p className="text-xs text-teal-800 font-pretendard leading-relaxed"><span className="font-bold text-teal-600 mr-1">2.</span>ì—¬í–‰ì„ ë§ˆì¹œë‚ ë¡œë¶€í„° <span className="font-bold">2ì£¼ì¼ ì´ë‚´ì— ì •ì‚°ì„œ ì œì¶œ</span><span className="block text-[10px] text-teal-600/70 mt-0.5">ã€Œê³µë¬´ì›ì—¬ë¹„ê·œì •ã€ ì œ8ì¡°ì˜2(ì—¬ë¹„ì˜ ê²°ì œì™€ ì •ì‚° ë“±)</span></p></div></div>
                                        {(result.data.note || result.specialNote) && (<div className="mt-4 space-y-2">{result.data.note && <p className="text-xs text-gray-500 font-pretendard bg-white px-3 py-2 rounded-lg border border-gray-100">* {result.data.note}</p>}{result.specialNote && (<div className="flex items-start gap-2 bg-yellow-50 p-3 rounded-lg border border-yellow-100/50"><Icons.Info size={14} className="text-yellow-600 mt-0.5 flex-shrink-0" /><p className="text-xs text-yellow-700 font-pretendard">{result.specialNote}</p></div>)}</div>)}
                                        <div className="mt-5 pt-4 border-t border-gray-200 opacity-100 transition-opacity">
                                            <div className="flex items-start justify-center gap-1.5 text-[11px] text-gray-500 font-pretendard font-medium">
                                                <Icons.Database size={12} className="mt-0.5 shrink-0 text-gray-400" />
                                                <div className="flex flex-col gap-0.5 items-center text-center">
                                                    {Array.isArray(result.source) ? result.source.map((src, i) => <span key={i}>{src}</span>) : <span>{result.source}</span>}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="text-center py-6">
                                        <Icons.Globe size={32} className="mx-auto mb-3 text-gray-300" />
                                        <h3 className="text-base font-bold text-gray-800 mb-1">DB ë¯¸ë“±ë¡ êµ¬ê°„</h3>
                                        <p className="text-xs text-gray-500 mb-4">ê´‘ì£¼Â·ì „ë‚¨ê¶Œ ë°–ì€ ì™¸ë¶€ê²€ìƒ‰ì„ ì´ìš©í•´ì£¼ì„¸ìš”.</p>
                                        <a href="https://map.kakao.com/?target=car" target="_blank" rel="noopener noreferrer" className="inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded-xl bg-[#FEE500] text-[#191919] font-bold text-sm shadow-sm active:scale-95 transition-transform">ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸°</a>
                                    </div>
                                )}
                            </div>

                            <div className={`result-card p-6 bg-white wipe-layer wipe-overlay border-2 border-teal-500/10 relative ${showDetail ? 'active' : ''}`}>
                                <button onClick={() => setShowDetail(false)} className="absolute top-4 left-4 w-12 h-12 bg-[#00BFA5] text-white rounded-full shadow-md border border-white/20 flex flex-col items-center justify-center gap-0 z-20 hover:brightness-110 transition-all active:scale-95 animate-pulse-scale"><span className="text-[11px] font-bold leading-none block">í¸ë„</span><span className="text-[11px] font-bold leading-none mt-0.5 block">êµí†µë¹„</span></button>
                                <a href="https://docs.google.com/spreadsheets/d/10v8CuQTEWWYuh-rGUDWfT3XmHShj3QP64bm8u0GFG4E/edit?usp=sharing" target="_blank" rel="noopener noreferrer" className="absolute top-4 right-4 w-12 h-12 bg-[#FFD700] text-white rounded-full shadow-md border border-white/20 flex flex-col items-center justify-center gap-0 z-20 hover:brightness-110 transition-all active:scale-95 animate-pulse-scale"><span className="text-[10px] font-bold leading-none text-yellow-900">ìš”ê¸ˆ</span><span className="text-[10px] font-bold leading-none mt-0.5 text-yellow-900">ì œë³´</span></a>

                                <div className="text-center mb-6 mt-8"><h3 className="font-bold font-suit text-xl text-teal-600 flex items-center justify-center gap-2"><Icons.Calculator size={20} /> {result.type === 'intraCity' ? 'ê´€ë‚´ì—¬ë¹„ê³„ì‚°' : 'ì—¬ë¹„ê³„ì‚°'}</h3>{result.type !== 'intraCity' && (<p className="text-sm text-gray-500 mt-2 font-pretendard">{getTravelerText()} {origin} â†” {destination} {deductions.gov_vehicle || intraDeductions.govVehicle ? 'ê´€ìš©ì°¨ëŸ‰ìœ¼ë¡œ' : 'ìê°€ìš©ìœ¼ë¡œ'} ë‹¹ì¼ ì™•ë³µí•œ ê²½ìš°</p>)}</div>

                                <div className="space-y-2 mb-4 bg-gray-50 p-4 rounded-xl border border-gray-100">
                                    {result.type === 'intraCity' ? (
                                        <>
                                            <div className="flex justify-between items-center py-2 border-b border-gray-200 mb-2"><span className="text-sm font-bold text-gray-900 font-pretendard">ê´€ë‚´ì—¬ë¹„</span><span className="text-xl font-bold font-suit text-gray-700">{fmt(detailCosts.total)}<span className="text-xs font-normal text-gray-400 ml-0.5">ì›</span></span></div>
                                            <div className="space-y-3">
                                                <div className="flex justify-between items-center"><span className="text-sm font-bold text-gray-600 font-pretendard">4ì‹œê°„ ì´í•˜</span><button onClick={() => setIntraDeductions(prev => ({...prev, shortTime: !prev.shortTime}))} className={getDeductionBtnClass(intraDeductions.shortTime)}>ê°ì•¡</button></div>
                                                <div className="flex justify-between items-center"><span className="text-sm font-bold text-gray-600 font-pretendard">ê´€ìš©ì°¨ëŸ‰ ì´ìš©</span><button onClick={() => setIntraDeductions(prev => ({...prev, govVehicle: !prev.govVehicle}))} className={getDeductionBtnClass(intraDeductions.govVehicle)}>ê°ì•¡</button></div>
                                            </div>
                                        </>
                                    ) : (
                                        <>
                                            <div className="flex justify-between items-center py-1"><div className="flex items-center gap-2"><span className="text-sm font-bold text-gray-600 font-pretendard w-10">ì¼ë¹„</span><button onClick={() => setActiveModal('daily')} className={getDeductionBtnClass(deductions.gov_vehicle)}>ê°ì•¡</button></div><span className="text-sm font-bold font-suit text-gray-700">{fmt(detailCosts.daily)}<span className="text-xs font-normal text-gray-400 ml-0.5">ì›</span></span></div>
                                            <div className="flex justify-between items-start py-1"><div className="flex items-center gap-2 mt-0.5"><span className="text-sm font-bold text-gray-600 font-pretendard w-10">ì‹ë¹„</span><button onClick={() => setActiveModal('meal')} className={getDeductionBtnClass(deductions.meal_1 || deductions.meal_2 || deductions.meal_3 || deductions.meal_half)}>ê°ì•¡</button></div><div className="flex flex-col items-end"><span className="text-sm font-bold font-suit text-gray-700">{fmt(detailCosts.meal)}<span className="text-xs font-normal text-gray-400 ml-0.5">ì›</span></span>{(25000 - detailCosts.meal > 0) && <span className="block text-[11px] text-red-400 font-pretendard mt-0.5">(-{fmt(25000 - detailCosts.meal)})</span>}</div></div>
                                            <div className="flex justify-between items-start py-1">
                                                <div className="flex items-center gap-2"><span className="text-sm font-bold text-gray-600 font-pretendard w-10">êµí†µë¹„</span><button onClick={() => setActiveModal('transport')} className={getDeductionBtnClass(isTransportDeducted)}>ê°ì•¡</button>{result.type === 'external' && (<a href={`https://map.kakao.com/?target=car`} target="_blank" rel="noopener noreferrer" className="px-2 py-1.5 text-[11px] font-bold rounded-lg bg-[#FEE500] text-[#191919] hover:brightness-95 transition-all shadow-sm whitespace-nowrap">ì¹´ì¹´ì˜¤ë§µê²€ìƒ‰</a>)}</div>
                                                <div className="flex flex-col items-end">
                                                    {result.type === 'external' && !isTransportDeducted ? (
                                                        <div className="flex items-center justify-end gap-1 w-full max-w-[100px]"><input type="number" step="1000" value={customTransport === '' ? '' : customTransport} onChange={(e) => setCustomTransport(e.target.value)} placeholder="0" className="ship-fare-input w-full text-right" /><span className="text-xs font-normal text-gray-400">ì›</span></div>
                                                    ) : (
                                                        result.isSpecial && !isTransportDeducted ? (
                                                            <div className="flex items-center justify-end gap-1 w-full max-w-[100px]"><input type="number" step="1000" value={manualMainTransport === null ? '' : manualMainTransport} onChange={(e) => setManualMainTransport(Number(e.target.value))} className="ship-fare-input w-full text-right" /><span className="text-xs font-normal text-gray-400">ì›</span></div>
                                                        ) : (
                                                            <span className="text-sm font-bold font-suit text-gray-700 mt-1">{fmt(detailCosts.transport)}<span className="text-xs font-normal text-gray-400 ml-0.5">ì›</span></span>
                                                        )
                                                    )}
                                                    {result.islandType === 'connected' && !isTransportDeducted && <span className="text-[10px] text-teal-600 font-bold mt-0.5">í• ì¦ë£Œ í¬í•¨</span>}
                                                </div>
                                            </div>

                                            {(result.isShipOnlyRoute || result.type === 'external') && (
                                                <div className="flex justify-between items-start py-1">
                                                    <div className="flex items-center gap-2 mt-1"><span className="text-sm font-bold text-gray-600 font-pretendard w-16">ê¸°íƒ€êµí†µë¹„</span></div>
                                                    <div className="flex flex-col items-end">
                                                        <div className="flex items-center justify-end gap-1"><input type="number" step="1000" value={shipFare === 0 ? '' : shipFare} onChange={(e) => setShipFare(Number(e.target.value))} placeholder="0" className="ship-fare-input" /><span className="text-xs font-normal text-gray-400">ì›</span></div>
                                                        <span className="text-[10px] font-bold text-blue-500 font-pretendard mt-0.5">ìŠ¹ì„ ê¶Œ í•©ê³„ ì…ë ¥</span>
                                                    </div>
                                                </div>
                                            )}

                                            <div className="border-t border-gray-200 my-2"></div>
                                            <div className="flex justify-between items-center pt-1"><span className="text-sm font-bold text-gray-900 font-pretendard">í•©ê³„</span><span className="text-xl font-bold font-suit text-teal-600">{fmt(detailCosts.total)}<span className="text-sm font-medium text-teal-400 ml-1">ì›</span></span></div>
                                        </>
                                    )}
                                </div>
                                {result.type !== 'intraCity' && (<div className="mt-5 space-y-2"><div className="flex items-start gap-1.5"><span className="text-xs text-red-500 mt-0.5 font-bold">â€»</span><p className="text-xs text-red-600 font-bold font-pretendard leading-tight">ë‹¨ì²´í–‰ì‚¬ ì¸ì†” ì‹œ ì˜ˆì‚°ìœ¼ë¡œ ìˆ™ë°•Â·ì‹ì‚¬ê³„ì•½ ì²´ê²°ëœ ê²½ìš° ì£¼ì˜</p></div><div className="flex items-start gap-1.5"><span className="text-xs text-gray-600 mt-0.5">â€»</span><p className="text-xs text-gray-600 font-pretendard leading-tight">ì—¬ê°ì„ ì„ ì´ìš©í•œ ê²½ìš°, ìŠ¹ì„ ê¶Œ í•©ê³„ê¸ˆì•¡ì„ ê¸°íƒ€êµí†µë¹„ì— ì…ë ¥</p></div></div>)}
                            </div>
                        </div>
                    )}

                    <footer className="mt-0.5 text-center text-gray-500 text-[10px] font-extrabold leading-relaxed font-gmarket mb-4 tracking-wide px-4">crafted with passion by ì „í˜„ìš°@ìš°ìˆ˜ì˜ì´ˆë“±í•™êµ<br/>deployment approved</footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
