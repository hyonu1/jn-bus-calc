<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>yb-easy in Crimson</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        window.tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        crimson: {
                            800: '#8B0000', 
                            900: '#6B0000', 
                        },
                        tiger: {
                            yellow: '#F5A623', 
                            black: '#1C1C1E',  
                            beige: '#F5F0E6', 
                        }
                    },
                    animation: {
                        'pulse-spread': 'pulse-spread 2.5s infinite',
                        'slide-up': 'slideUpModal 0.25s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    },
                    keyframes: {
                        'pulse-spread': { '0%': { boxShadow: '0 0 0 0 rgba(139, 0, 0, 0.4)' }, '70%': { boxShadow: '0 0 0 10px rgba(139, 0, 0, 0)' }, '100%': { boxShadow: '0 0 0 0 rgba(139, 0, 0, 0)' } },
                        'slideUpModal': { 'from': { transform: 'translateY(15px)', opacity: '0' }, 'to': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        @import url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.css');
        
        :root {
            --font-gmarket: 'GmarketSansMedium', sans-serif;
            --font-pretendard: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            --color-crimson: #8B0000;
            --color-yellow: #F5A623;
            --color-black: #1C1C1E;
            --color-bg-base: #F2F2F7;
            --color-text-main: #1C1C1E;
        }

        html, body { margin: 0; padding: 0; font-family: var(--font-pretendard); color: var(--color-text-main); -webkit-font-smoothing: antialiased; background-color: var(--color-bg-base); }
        body { display: flex; justify-content: center; align-items: flex-start; min-height: 100dvh; }
        .main-wrapper { width: 100%; max-width: 480px; min-height: 100dvh; display: flex; flex-direction: column; background-color: var(--color-bg-base); }
        .scroll-area { flex: 1; overflow-y: auto; }
        @media (min-width: 768px) {
            body { background-color: #D0D0D8; align-items: center; padding: 24px 0; box-sizing: border-box; min-height: 100dvh; }
            .main-wrapper { min-height: unset; max-height: calc(100dvh - 48px); border-radius: 36px; overflow: hidden; box-shadow: 0 24px 80px rgba(0,0,0,0.18), 0 0 0 1px rgba(0,0,0,0.06); }
            .scroll-area { overflow-y: auto; }
        }

        .input-group { 
            background-color: #FFFFFF; border-radius: 20px; padding: 0 20px; display: flex; align-items: center; gap: 16px; width: 100%; box-sizing: border-box; height: 76px; border: 2px solid transparent; font-family: var(--font-gmarket); 
            box-shadow: 0 4px 16px rgba(0,0,0,0.04); transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .input-group:focus-within { border-color: var(--color-crimson); box-shadow: 0 4px 20px rgba(139, 0, 0, 0.12); transform: translateY(-1px); }

        .tag-badge {
            display: inline-flex; align-items: center; justify-content: center;
            border-radius: 8px; font-weight: 800;
            margin: 0 2px; font-family: var(--font-gmarket); 
            box-shadow: 0 1px 2px rgba(0,0,0,0.04); border: 1px solid transparent;
        }

        .tag-side {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 1px 4px; border-radius: 4px; font-size: 9px; font-weight: 700;
            margin-left: 2px; white-space: nowrap; font-family: var(--font-pretendard); border: 1px solid transparent;
            position: relative; top: -6px;
        }

        .header-teal { 
            background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); 
            border-bottom: 1px solid rgba(139, 0, 0, 0.08); padding: 14px 20px; display: flex; align-items: center; justify-content: space-between; 
            width: 100%; position: sticky; top: 0; z-index: 50; 
        }
        .mode-switch-container { display: flex; align-items: center; justify-content: center; background-color: #E5E5EA; border-radius: 99px; width: 110px; height: 38px; position: relative; cursor: pointer; padding: 3px; user-select: none; }
        .mode-switch-slider { position: absolute; top: 3px; bottom: 3px; width: calc(50% - 3px); background-color: #FFFFFF; border-radius: 99px; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 3px 8px rgba(0,0,0,0.12), 0 1px 1px rgba(0,0,0,0.04); }
        .mode-switch-slider.extra { left: 3px; }
        .mode-switch-slider.intra { left: calc(50%); }
        .mode-text { flex: 1; z-index: 10; text-align: center; font-size: 13px; font-weight: 800; transition: color 0.2s; }
        .mode-text.active { color: var(--color-crimson); }
        .mode-text.inactive { color: #8E8E93; }

        .deduct-btn {
            position: absolute; left: 50%; top: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 12px; padding: 6px 14px; border-radius: 10px; font-weight: 800;
            cursor: pointer; z-index: 10; font-family: var(--font-gmarket); 
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(180deg, #9B1111 0%, #8B0000 50%, #7A0000 100%);
            color: #FFFFFF;
            border: none;
            box-shadow: 
                0 2px 4px rgba(139, 0, 0, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
        }
        .deduct-btn:hover {
            background: linear-gradient(180deg, #A51515 0%, #950505 50%, #850000 100%);
            box-shadow: 
                0 3px 6px rgba(139, 0, 0, 0.35),
                0 6px 12px rgba(0, 0, 0, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.25);
        }
        .deduct-btn.active { 
            background: linear-gradient(180deg, #E5E0D6 0%, #F5F0E6 100%);
            color: #8E8E93; 
            border: 1px solid #D5D0C6;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.12), inset 0 1px 2px rgba(0, 0, 0, 0.08);
            text-shadow: none;
            transform: translate(-50%, calc(-50% + 1px)); 
        }
        
        input.ship-fare-input { 
            text-align: right; 
            background-color: #F8F9FA; 
            width: 84px; 
            font-family: var(--font-gmarket); 
            font-weight: 700; 
            outline: none; 
            border: 1px solid #E5E5EA; 
            border-radius: 8px;
            padding: 6px 8px; 
            margin: 0; 
            color: #8E8E93; 
            font-size: 15px; 
            transition: all 0.2s;
        }
        
        input.ship-fare-input:focus { 
            border-color: var(--color-yellow); 
            color: var(--color-black); 
            background-color: #FFFFFF;
            box-shadow: 0 2px 8px rgba(245, 166, 35, 0.15); 
        }

        input.ship-fare-input::selection {
            background-color: rgba(245, 166, 35, 0.2); 
            color: #1C1C1E; 
        }

        .suggestions-box { position: absolute; left: 0; right: 0; top: 100%; margin-top: 8px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(139,0,0,0.08); border-radius: 20px; z-index: 999; box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12); max-height: 240px; overflow-y: auto; font-family: var(--font-gmarket); }
        .suggestion-item { padding: 14px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-size: 15px; color: #1C1C1E; font-weight: 500; border-bottom: 1px solid rgba(0,0,0,0.03); }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item:hover, .suggestion-item.active { background-color: rgba(245, 166, 35, 0.1); }

        @keyframes bounce-custom {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20%); } 
        }
        .icon-bounce { display: inline-block; animation: bounce-custom 2s infinite; margin-left: 4px; }
        
        .toggle-switch { width: 44px; height: 24px; border-radius: 99px; transition: 0.25s cubic-bezier(0.16, 1, 0.3, 1); position: relative; }
        .toggle-knob { width: 20px; height: 20px; background: white; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: 0.25s cubic-bezier(0.16, 1, 0.3, 1); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .toggle-active { background: var(--color-yellow); } 
        .toggle-inactive { background: #E5E5EA; }
        .knob-active { transform: translateX(20px); }

        /* ‚îÄ‚îÄ Ìó§Îçî: ÏûêÏó∞Ïä§ÎüΩÍ≤å ÌùêÎ¶ÑÏóê Ìè¨Ìï® ‚îÄ‚îÄ */
        .header-teal {
            background: var(--color-bg-base) !important;
            border-bottom: 1px solid rgba(139, 0, 0, 0.10) !important;
            padding: 9px 18px !important;
            display: flex !important; align-items: center !important; justify-content: space-between !important;
            width: 100% !important; box-sizing: border-box !important;
            position: static !important;
        }
        .header-teal h1 { font-size: 22px !important; }
        .header-teal p { margin-top: 1px !important; font-size: 10px !important; }
        .content-main { padding-top: 24px !important; padding-bottom: 32px !important; }

        /* ‚îÄ‚îÄ ÌïòÎã®Î∞î: ÏúÑÏïÑÎûò ÎÑâÎÑâÌïú Ïó¨Î∞±ÏúºÎ°ú Ïà®ÌÜµ ‚îÄ‚îÄ */
        .bottom-nav {
            width: 100%; height: 58px;
            background: var(--color-bg-base);
            border-top: 1px solid rgba(139, 0, 0, 0.10);
            display: flex; align-items: center; justify-content: space-around;
            box-sizing: border-box; padding: 0 28px;
            padding-bottom: env(safe-area-inset-bottom, 0px);
            position: static;
            flex-shrink: 0;
        }
        .nav-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; background: none; border: none; outline: none;
            gap: 3px; padding: 6px 12px;
            color: #8B0000;
            transition: opacity 0.15s;
            -webkit-tap-highlight-color: transparent;
        }
        .nav-btn:active { opacity: 0.5; }
        .nav-btn-label { font-size: 10px; font-weight: 700; color: #8B0000; font-family: var(--font-pretendard); }

        /* ‚îÄ‚îÄ ÏïÑÏù¥Ìè∞ ÌÅ¥ÎûòÏãù ÌôàÎ≤ÑÌäº ‚îÄ‚îÄ */
        .home-btn-wrap {
            position: relative; display: flex; flex-direction: column; align-items: center;
            cursor: pointer; -webkit-tap-highlight-color: transparent;
        }
        .home-btn {
            width: 48px; height: 48px; border-radius: 50%;
            background: linear-gradient(145deg, #e2e2e2 0%, #d8d8d8 30%, #c8c8c8 60%, #bcbcbc 100%);
            border: 1.5px solid rgba(0,0,0,0.20);
            box-shadow:
                0 5px 10px rgba(0,0,0,0.25),
                0 2px 4px rgba(0,0,0,0.18),
                inset 0 2px 2px rgba(255,255,255,0.75),
                inset 0 -3px 6px rgba(0,0,0,0.18),
                inset 0 0 0 8px rgba(0,0,0,0.04);
            display: flex; align-items: center; justify-content: center;
            position: relative; overflow: hidden;
            transition: all 0.12s cubic-bezier(0.16, 1, 0.3, 1);
        }
        /* ÏïàÏ™Ω ÏõêÌòï ÎßÅ */
        .home-btn::before {
            content: '';
            width: 38px; height: 38px; border-radius: 50%;
            background: linear-gradient(150deg, #d0d0d0 0%, #c0c0c0 40%, #b4b4b4 70%, #acacac 100%);
            border: 1px solid rgba(0,0,0,0.14);
            box-shadow:
                inset 0 3px 6px rgba(0,0,0,0.22),
                inset 0 1px 3px rgba(0,0,0,0.14),
                0 1px 0 rgba(255,255,255,0.55);
            position: absolute;
        }
        /* ÌÅ¨Î¶ºÏä® Îë•Í∑º ÏÇ¨Í∞ÅÌòï Í∞ÅÏù∏ */
        .home-btn::after {
            content: '';
            width: 20px; height: 20px;
            border-radius: 5px;
            background: transparent;
            border: 2.5px solid rgba(139, 0, 0, 0.70);
            box-shadow:
                0 1px 2px rgba(0,0,0,0.15),
                inset 0 1px 1px rgba(255,255,255,0.08);
            position: absolute; z-index: 1;
            filter: drop-shadow(0 1px 1px rgba(139,0,0,0.3));
        }
        .home-btn:active {
            box-shadow: 0 1px 3px rgba(0,0,0,0.28), inset 0 3px 7px rgba(0,0,0,0.22), inset 0 1px 3px rgba(0,0,0,0.15);
            transform: scale(0.92);
        }

        /* ‚îÄ‚îÄ ÌûàÏä§ÌÜ†Î¶¨ ÎßêÌíçÏÑ† Ìà¥ÌåÅ: ÏãúÍ≥Ñ Î≤ÑÌäº Î∞îÎ°ú ÏúÑ ‚îÄ‚îÄ */
        .history-tooltip {
            position: absolute; bottom: calc(100% + 10px); right: -8px;
            background: rgba(245, 240, 230, 0.99);
            border: 1px solid rgba(139,0,0,0.15);
            border-radius: 14px;
            padding: 8px 0;
            min-width: 220px;
            box-shadow: 0 8px 28px rgba(0,0,0,0.16), 0 2px 6px rgba(0,0,0,0.08);
            z-index: 300;
            animation: tooltipIn 0.18s cubic-bezier(0.16,1,0.3,1) forwards;
        }
        .history-tooltip::after {
            content: '';
            position: absolute; bottom: -7px; right: 18px;
            width: 14px; height: 14px;
            background: rgba(245, 240, 230, 0.99);
            border-right: 1px solid rgba(139,0,0,0.15);
            border-bottom: 1px solid rgba(139,0,0,0.15);
            transform: rotate(45deg);
            border-radius: 2px;
        }
        @keyframes tooltipIn {
            from { opacity: 0; transform: translateY(6px) scale(0.97); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .tooltip-item {
            padding: 9px 16px; display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; transition: background 0.1s;
            border-bottom: 1px solid rgba(139,0,0,0.07);
        }
        .tooltip-item:last-child { border-bottom: none; }
        .tooltip-item:hover { background: rgba(139,0,0,0.06); }
        .tooltip-item:active { background: rgba(139,0,0,0.12); }
        .tooltip-empty { padding: 12px 16px; text-align: center; font-size: 12px; color: #8E8E93; font-weight: 600; }

        /* ‚îÄ‚îÄ ÏÉÅÌÉú ÌëúÏãú Î≤ÑÌäº ‚îÄ‚îÄ */
        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes dotTrail {
            0%   { content: ''; }
            25%  { content: '.'; }
            50%  { content: '..'; }
            75%  { content: '...'; }
            100% { content: ''; }
        }
        @keyframes statusDots {
            0%, 20%  { color: transparent; text-shadow: 6px 0 0 transparent, 12px 0 0 transparent; }
            40%      { color: rgba(139,0,0,0.6); text-shadow: 6px 0 0 transparent, 12px 0 0 transparent; }
            60%      { color: rgba(139,0,0,0.9); text-shadow: 6px 0 0 rgba(139,0,0,0.6), 12px 0 0 transparent; }
            80%,100% { color: #8B0000; text-shadow: 6px 0 0 rgba(139,0,0,0.9), 12px 0 0 rgba(139,0,0,0.6); }
        }
        .status-bar-idle {
            width: 100%; height: 38px; border-radius: 14px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            font-size: 12px; font-weight: 700; font-family: var(--font-pretendard);
            color: #8E8E93;
            background: linear-gradient(180deg, #EFEFEF 0%, #E8E8E8 100%);
            border: 1px solid #D8D8D8;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.8), 0 1px 2px rgba(0,0,0,0.04);
        }
        .status-bar-working {
            width: 100%; height: 38px; border-radius: 14px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            font-size: 12px; font-weight: 700; font-family: var(--font-pretendard);
            color: #8B0000;
            background: linear-gradient(180deg, #F5EFE6 0%, #EDE5D8 100%);
            border: 1px solid rgba(139,0,0,0.18);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.9), 0 1px 3px rgba(139,0,0,0.08);
            animation: statusPulse 1.4s ease-in-out infinite;
        }
        .status-bar-done {
            width: 100%; height: 38px; border-radius: 14px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            font-size: 12px; font-weight: 700; font-family: var(--font-pretendard);
            color: #8B0000;
            background: linear-gradient(180deg, #F7F2E8 0%, #F5F0E6 50%, #EDE8DE 100%);
            border: 1px solid rgba(139,0,0,0.14);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.9), 0 2px 4px rgba(139,0,0,0.06);
            cursor: default;
        }
        .dots-anim {
            display: inline-flex; gap: 3px; align-items: center;
        }
        .dots-anim span {
            width: 4px; height: 4px; border-radius: 50%; background: #8B0000;
        }
        .dots-anim span:nth-child(1) { animation: dotBounce 1.2s 0s infinite; }
        .dots-anim span:nth-child(2) { animation: dotBounce 1.2s 0.2s infinite; }
        .dots-anim span:nth-child(3) { animation: dotBounce 1.2s 0.4s infinite; }
        @keyframes dotBounce {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        /* ‚îÄ‚îÄ ÌôïÏù∏ Î≤ÑÌäº: ÎÖ∏ÎûÄÏÉâ Î∞∞Í≤Ω ‚Üí ÌÅ¥Î¶≠ Ïãú Ìù∞ÏÉâ Î∞òÏ†Ñ ‚îÄ‚îÄ */
        .confirm-btn-yellow {
            background: linear-gradient(180deg, #F7F2E8 0%, #F5F0E6 50%, #EDE8DE 100%) !important;
            color: #8B0000 !important;
            border: 1px solid #E5E0D6 !important;
            transition: all 0.15s !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04), inset 0 1px 0 rgba(255,255,255,0.8) !important;
        }
        .confirm-btn-yellow:active {
            background: linear-gradient(180deg, #EDE8DE 0%, #EAE5DB 100%) !important;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.08) !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const Icons = {
            MapPin: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Search: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            ChevronDown: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m6 9 6 6 6-6"/></svg>,
            X: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Send: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="22" x2="11" y1="2" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            Calculator: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/></svg>,
            Rocket: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg>,
            Clock: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        };

        const REGION_ICONS = {
            "Í¥ëÏ£º": "üçâ", "Î™©Ìè¨": "‚öì", "Ïó¨Ïàò": "üåâ", "ÏàúÏ≤ú": "ü¶©", "ÎÇòÏ£º": "üçê", "Í¥ëÏñë": "üíÆ",
            "Îã¥Ïñë": "üéã", "Í≥°ÏÑ±": "üöÇ", "Íµ¨Î°Ä": "üêª", "Í≥†Ìù•": "üöÄ", "Î≥¥ÏÑ±": "üçµ", "ÌôîÏàú": "üóø", "Ïû•Ìù•": "üçÑ",
            "Í∞ïÏßÑ": "üè∫", "Ìï¥ÎÇ®": "ü¶ñ", "ÏòÅÏïî": "üèéÔ∏è", "Î¨¥Ïïà": "üßÖ", "Ìï®Ìèâ": "ü¶ã", "ÏòÅÍ¥ë": "üêü", "Ïû•ÏÑ±": "üçÇ", "ÏôÑÎèÑ": "ü¶™", "ÏßÑÎèÑ": "üêï",
            "Ïã†Ïïà": "üëº", "Ïã†ÏïàÍµêÏú°Ï≤≠": "‚öìÔ∏è", "ÎÇ®ÏïÖ": "üèõÔ∏è", "ÏßÄÎèÑ": "üßÇ", "ÏïïÌï¥": "üêô", "Ï¶ùÎèÑ": "üö≤", "ÏûÑÏûê": "üå∑",
            "ÏûêÏùÄ": "üèñÔ∏è", "ÏïàÏ¢å": "üôã‚Äç‚ôÄÔ∏è", "ÌåîÍ∏à": "ü¶ê", "ÏïîÌÉú": "üåÅ", "ÎπÑÍ∏à": "ü¶Ö", "ÎèÑÏ¥à": "üåº", "ÌùëÏÇ∞": "üé£", "ÌïòÏùò": "üïäÔ∏è", "Ïã†Ïùò": "üßÇ", "Ïû•ÏÇ∞": "üèîÔ∏è",
            "Ï≤≠ÏÇ∞": "üêå", "ÎÖ∏Ìôî": "ü¶™", "ÏÜåÏïà": "üå∫", "Ïó¨ÏÑúÎèÑ": "üóø", "Í∏àÏùº": "üåä", "ÏÉùÏùº": "üéÇ", "Î≥¥Í∏∏": "üìú", 
            "Í∏àÎãπ": "üóø", "Íµ∞Ïô∏": "‚òÄÔ∏è", "Ïã†ÏßÄ": "üèñÔ∏è", "Í≥†Í∏à": "üö¢", "ÏïΩÏÇ∞": "üêê", "ÌôçÎèÑ": "üåÖ", "Í∞ÄÍ±∞ÎèÑ": "üèùÔ∏è", "ÎßåÏû¨ÎèÑ": "üé£", 
            "ÏßÑÎèÑÏ°∞ÎèÑ": "üê¶", "ÏßÑÎèÑÏÑúÍ±∞Ï∞®ÎèÑ": "üßó", "ÏßÑÎèÑÍ¥ÄÎß§ÎèÑ": "üèµÔ∏è", "Í≥†Ìù•ÎìùÎüâÎèÑ": "üåæ", "Í≥†Ìù•Ïë•ÏÑ¨(Ïï†ÎèÑ)": "üêà",
            "ÏòÅÍ¥ëÏïàÎßàÎèÑ": "üêé", "ÏòÅÍ¥ëÎÇôÏõî": "üåô", "ÏòÅÍ¥ëÏÜ°Ïù¥ÎèÑ": "üëÇ", "Ìï¥ÎÇ®Ïñ¥Î£°ÎèÑ": "üêâ"
        };

        const POPUP_REGIONS = {
            "Ïã†Ïïà": ["Ïã†ÏïàÍµêÏú°Ï≤≠", "ÏßÄÎèÑ", "ÏïïÌï¥", "Ï¶ùÎèÑ", "ÏûÑÏûê", "ÏûêÏùÄ", "ÏïàÏ¢å", "ÌåîÍ∏à", "ÏïîÌÉú", "ÎπÑÍ∏à", "ÎèÑÏ¥à", "ÌùëÏÇ∞", "ÌïòÏùò", "Ïã†Ïùò", "Ïû•ÏÇ∞", "ÌôçÎèÑ", "Í∞ÄÍ±∞ÎèÑ", "ÎßåÏû¨ÎèÑ"],
            "ÏôÑÎèÑ": ["ÏôÑÎèÑ", "Í∏àÏùº", "ÎÖ∏Ìôî", "Íµ∞Ïô∏", "Ïã†ÏßÄ", "Í≥†Í∏à", "ÏïΩÏÇ∞", "Ï≤≠ÏÇ∞", "ÏÜåÏïà", "Í∏àÎãπ", "Î≥¥Í∏∏", "ÏÉùÏùº", "Ïó¨ÏÑúÎèÑ"]
        };

        const ISLAND_DB = {
            "Ïã†Ïïà": { hub: "Î™©Ìè¨", cost: 0, type: "connected" }, "Ïã†ÏïàÍµêÏú°Ï≤≠": { hub: "Î™©Ìè¨", cost: 0, type: "connected" }, "ÏïïÌï¥": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" }, "ÏßÄÎèÑ": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" }, "Ï¶ùÎèÑ": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" }, "ÏûÑÏûê": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" }, "ÌåîÍ∏à": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" }, "ÏïîÌÉú": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" }, "ÏûêÏùÄ": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" }, "ÏïàÏ¢å": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" }, 
            "ÎπÑÍ∏à": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨, ÏïîÌÉú", cost: 2000, shipCost: 1000, type: "ship", special: true }, 
            "ÎèÑÏ¥à": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship", special: true }, 
            "Ïû•ÏÇ∞": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" }, "ÌïòÏùò": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" }, "Ïã†Ïùò": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" }, "ÌùëÏÇ∞": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" }, "ÌôçÎèÑ": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" }, "Í∞ÄÍ±∞ÎèÑ": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" }, "ÎßåÏû¨ÎèÑ": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" }, "ÏôÑÎèÑ": { hub: "ÏôÑÎèÑ", cost: 0, type: "connected", special: true }, "Íµ∞Ïô∏": { hub: "ÏôÑÎèÑ", cost: 0, type: "connected", special: true }, "Ïã†ÏßÄ": { hub: "ÏôÑÎèÑ", cost: 0, type: "connected", special: true }, "Í≥†Í∏à": { hub: "ÏôÑÎèÑ", cost: 0, type: "connected", special: true }, "ÏïΩÏÇ∞": { hub: "ÏôÑÎèÑ", cost: 0, type: "connected", special: true }, "Ï≤≠ÏÇ∞": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" }, "ÎÖ∏Ìôî": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" }, "Î≥¥Í∏∏": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" }, "ÏÜåÏïà": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" }, "Ïó¨ÏÑúÎèÑ": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" }, "Í∏àÏùº": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" }, "ÏÉùÏùº": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" }, "ÏßÑÎèÑÏ°∞ÎèÑ": { hub: "ÏßÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" }, "ÏßÑÎèÑÍ¥ÄÎß§ÎèÑ": { hub: "ÏßÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" }, "ÏßÑÎèÑÏÑúÍ±∞Ï∞®ÎèÑ": { hub: "ÏßÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" }, "Í≥†Ìù•ÎìùÎüâÎèÑ": { hub: "Í≥†Ìù•", cost: 0, shipCost: 1000, type: "ship" }, "Í≥†Ìù•Ïë•ÏÑ¨(Ïï†ÎèÑ)": { hub: "Í≥†Ìù•", cost: 0, shipCost: 1000, type: "ship" }, "ÏòÅÍ¥ëÏïàÎßàÎèÑ": { hub: "ÏòÅÍ¥ë", cost: 0, shipCost: 1000, type: "ship" }, "ÏòÅÍ¥ëÎÇôÏõî": { hub: "ÏòÅÍ¥ë", cost: 0, shipCost: 1000, type: "ship" }, "ÏòÅÍ¥ëÏÜ°Ïù¥ÎèÑ": { hub: "ÏòÅÍ¥ë", cost: 0, shipCost: 1000, type: "ship" }, "Í∏àÎãπ": { hub: "Ïû•Ìù•", cost: 0, shipCost: 1000, type: "ship" }, "Ìï¥ÎÇ®Ïñ¥Î£°ÎèÑ": { hub: "Ìï¥ÎÇ®", cost: 0, shipCost: 1000, type: "ship" }
        };

        const SAME_AREA_GROUPS = [
            new Set(["Î™©Ìè¨", "Ïã†Ïïà", "Ïã†ÏïàÍµêÏú°Ï≤≠"]), new Set(["ÎÖ∏Ìôî", "Î≥¥Í∏∏"]), new Set(["ÎπÑÍ∏à", "ÎèÑÏ¥à"]),
            new Set(["ÏïïÌï¥", "ÏûêÏùÄ", "ÌåîÍ∏à", "ÏïîÌÉú", "ÏïàÏ¢å", "ÏûÑÏûê", "ÏßÄÎèÑ", "Ï¶ùÎèÑ"]),
            new Set(["Íµ∞Ïô∏", "ÏôÑÎèÑ", "Í≥†Í∏à", "ÏïΩÏÇ∞", "Ïã†ÏßÄ", "Í∏àÎãπ"])
        ];

        const INITIAL_DATA = {
            "Í¥ëÏ£º": { "Î™©Ìè¨": { gen: 7200, pre: 9300 }, "Ïó¨Ïàò": { gen: 13000, pre: 16800 }, "ÏàúÏ≤ú": { gen: 8400, pre: 11000 }, "ÎÇòÏ£º": { gen: 4300 }, "Í¥ëÏñë": { gen: 8400, pre: 10900 }, "Îã¥Ïñë": { gen: 2900 }, "Í≥°ÏÑ±": { gen: 5500 }, "Íµ¨Î°Ä": { gen: 9800 }, "Í≥†Ìù•": { gen: 16200, pre: 21000 }, "Î≥¥ÏÑ±": { gen: 10500, pre: 11500 }, "ÌôîÏàú": { gen: 2500 }, "Ïû•Ìù•": { gen: 11500, pre: 14900 }, "Í∞ïÏßÑ": { gen: 11700, pre: 15200 }, "Ìï¥ÎÇ®": { gen: 13700, pre: 16900 }, "ÏòÅÏïî": { gen: 8700 }, "Î¨¥Ïïà": { gen: 6000, pre: 7800 }, "Ìï®Ìèâ": { gen: 4500, pre: 5800 }, "ÏòÅÍ¥ë": { gen: 7300, pre: 9500 }, "Ïû•ÏÑ±": { gen: 2400 }, "ÏôÑÎèÑ": { gen: 20500, pre: 24800 }, "ÏßÑÎèÑ": { gen: 15300, pre: 19900 }, "ÎÇ®ÏïÖ": { gen: 7200, pre: 9300 } },
            "Î™©Ìè¨": { "Í¥ëÏ£º": { gen: 7200, pre: 9300 }, "Ïó¨Ïàò": { gen: 16500, pre: 21400 }, "ÏàúÏ≤ú": { gen: 11500, pre: 15000 }, "ÎÇòÏ£º": { gen: 7300 }, "Í¥ëÏñë": { gen: 13700, pre: 17800 }, "Îã¥Ïñë": { gen: 10100 }, "Í≥°ÏÑ±": { gen: 12700 }, "Íµ¨Î°Ä": { gen: 17000 }, "Í≥†Ìù•": { gen: 18600 }, "Î≥¥ÏÑ±": { gen: 13500 }, "ÌôîÏàú": { gen: 9700 }, "Ïû•Ìù•": { gen: 10200 }, "Í∞ïÏßÑ": { gen: 7800 }, "Ìï¥ÎÇ®": { gen: 8700 }, "ÏòÅÏïî": { gen: 6400 }, "Î¨¥Ïïà": { gen: 3200 }, "Ìï®Ìèâ": { gen: 5100 }, "ÏòÅÍ¥ë": { gen: 8700 }, "Ïû•ÏÑ±": { gen: 9600 }, "ÏôÑÎèÑ": { gen: 15700 }, "ÏßÑÎèÑ": { gen: 8300, pre: 10800 }, "ÎÇ®ÏïÖ": { gen: 1700 } },
            "Ïó¨Ïàò": { "Í¥ëÏ£º": { gen: 13000, pre: 16800 }, "Î™©Ìè¨": { gen: 16500, pre: 21400 }, "ÏàúÏ≤ú": { gen: 5000 }, "ÎÇòÏ£º": { gen: 17300 }, "Í¥ëÏñë": { gen: 7500 }, "Îã¥Ïñë": { gen: 15900 }, "Í≥°ÏÑ±": { gen: 18500 }, "Íµ¨Î°Ä": { gen: 10200 }, "Í≥†Ìù•": { gen: 13600 }, "Î≥¥ÏÑ±": { gen: 12800 }, "ÌôîÏàú": { gen: 15500 }, "Ïû•Ìù•": { gen: 16100 }, "Í∞ïÏßÑ": { gen: 18500 }, "Ìï¥ÎÇ®": { gen: 21500 }, "ÏòÅÏïî": { gen: 22400 }, "Î¨¥Ïïà": { gen: 19000 }, "Ìï®Ìèâ": { gen: 17500 }, "ÏòÅÍ¥ë": { gen: 20300 }, "Ïû•ÏÑ±": { gen: 15400 }, "ÏôÑÎèÑ": { gen: 28200 }, "ÏßÑÎèÑ": { gen: 24800 }, "ÎÇ®ÏïÖ": { gen: 15600, pre: 20200 } },
            "ÏàúÏ≤ú": { "Í¥ëÏ£º": { gen: 8400, pre: 11000 }, "Î™©Ìè¨": { gen: 11500, pre: 15000 }, "Ïó¨Ïàò": { gen: 5000 }, "ÎÇòÏ£º": { gen: 12700 }, "Í¥ëÏñë": { gen: 2500 }, "Îã¥Ïñë": { gen: 10100 }, "Í≥°ÏÑ±": { gen: 9400 }, "Íµ¨Î°Ä": { gen: 5200 }, "Í≥†Ìù•": { gen: 8700 }, "Î≥¥ÏÑ±": { gen: 7900 }, "ÌôîÏàú": { gen: 9700 }, "Ïû•Ìù•": { gen: 11100 }, "Í∞ïÏßÑ": { gen: 13500 }, "Ìï¥ÎÇ®": { gen: 16600 }, "ÏòÅÏïî": { gen: 17500 }, "Î¨¥Ïïà": { gen: 14700, pre: 18200 }, "Ìï®Ìèâ": { gen: 12900 }, "ÏòÅÍ¥ë": { gen: 15700 }, "Ïû•ÏÑ±": { gen: 10800 }, "ÏôÑÎèÑ": { gen: 23200 }, "ÏßÑÎèÑ": { gen: 23900 }, "ÎÇ®ÏïÖ": { gen: 10600, pre: 13800 } },
            "ÎÇòÏ£º": { "Í¥ëÏ£º": { gen: 4300 }, "Î™©Ìè¨": { gen: 7300 }, "Ïó¨Ïàò": { gen: 17300 }, "ÏàúÏ≤ú": { gen: 12700 }, "Í¥ëÏñë": { gen: 12700 }, "Îã¥Ïñë": { gen: 7200 }, "Í≥°ÏÑ±": { gen: 9800 }, "Íµ¨Î°Ä": { gen: 14100 }, "Í≥†Ìù•": { gen: 20500 }, "Î≥¥ÏÑ±": { gen: 14800 }, "ÌôîÏàú": { gen: 6800 }, "Ïû•Ìù•": { gen: 9000 }, "Í∞ïÏßÑ": { gen: 8200 }, "Ìï¥ÎÇ®": { gen: 9900 }, "ÏòÅÏïî": { gen: 4400 }, "Î¨¥Ïïà": { gen: 4100 }, "Ìï®Ìèâ": { gen: 3700 }, "ÏòÅÍ¥ë": { gen: 7400 }, "Ïû•ÏÑ±": { gen: 6700 }, "ÏôÑÎèÑ": { gen: 16600 }, "ÏßÑÎèÑ": { gen: 17200 }, "ÎÇ®ÏïÖ": { gen: 9000 } },
            "Í¥ëÏñë": { "Í¥ëÏ£º": { gen: 8400, pre: 10900 }, "Î™©Ìè¨": { gen: 13700, pre: 17800 }, "Ïó¨Ïàò": { gen: 7500 }, "ÏàúÏ≤ú": { gen: 2500 }, "ÎÇòÏ£º": { gen: 12700 }, "Îã¥Ïñë": { gen: 11300 }, "Í≥°ÏÑ±": { gen: 13900 }, "Íµ¨Î°Ä": { gen: 7700 }, "Í≥†Ìù•": { gen: 8700 }, "Î≥¥ÏÑ±": { gen: 9900 }, "ÌôîÏàú": { gen: 10900 }, "Ïû•Ìù•": { gen: 13200 }, "Í∞ïÏßÑ": { gen: 15600 }, "Ìï¥ÎÇ®": { gen: 19100 }, "ÏòÅÏïî": { gen: 19500 }, "Î¨¥Ïïà": { gen: 14400 }, "Ìï®Ìèâ": { gen: 12900 }, "ÏòÅÍ¥ë": { gen: 15700 }, "Ïû•ÏÑ±": { gen: 10800 }, "ÏôÑÎèÑ": { gen: 25800 }, "ÏßÑÎèÑ": { gen: 23400 }, "ÎÇ®ÏïÖ": { gen: 11700 } },
            "Îã¥Ïñë": { "Í¥ëÏ£º": { gen: 2900 }, "Î™©Ìè¨": { gen: 10100 }, "Ïó¨Ïàò": { gen: 15900 }, "ÏàúÏ≤ú": { gen: 10100 }, "ÎÇòÏ£º": { gen: 11300 }, "Í¥ëÏñë": { gen: 11300 }, "Í≥°ÏÑ±": { gen: 8400 }, "Íµ¨Î°Ä": { gen: 12700 }, "Í≥†Ìù•": { gen: 19100 }, "Î≥¥ÏÑ±": { gen: 13400 }, "ÌôîÏàú": { Îß§: 8000 }, "Ïû•Ìù•": { gen: 14400 }, "Í∞ïÏßÑ": { gen: 14600 }, "Ìï¥ÎÇ®": { gen: 16600 }, "ÏòÅÏïî": { gen: 11600 }, "Î¨¥Ïïà": { gen: 8900 }, "Ìï®Ìèâ": { gen: 7400 }, "ÏòÅÍ¥ë": { gen: 10200 }, "Ïû•ÏÑ±": { gen: 5300 }, "ÏôÑÎèÑ": { gen: 23400 }, "ÏßÑÎèÑ": { gen: 18200 }, "ÎÇ®ÏïÖ": { gen: 10100 } },
            "Í≥°ÏÑ±": { "Í¥ëÏ£º": { gen: 5500 }, "Î™©Ìè¨": { gen: 12700 }, "Ïó¨Ïàò": { gen: 18500 }, "ÏàúÏ≤ú": { gen: 9800 }, "ÎÇòÏ£º": { gen: 9800 }, "Í¥ëÏñë": { gen: 13900 }, "Îã¥Ïñë": { gen: 8400 }, "Íµ¨Î°Ä": { gen: 4300 }, "Í≥†Ìù•": { gen: 21400 }, "Î≥¥ÏÑ±": { gen: 17300 }, "ÌôîÏàú": { gen: 8000 }, "Ïû•Ìù•": { gen: 17000 }, "Í∞ïÏßÑ": { gen: 2400 }, "Ìï¥ÎÇ®": { gen: 19200 }, "ÏòÅÏïî": { gen: 14200 }, "Î¨¥Ïïà": { gen: 11500 }, "Ìï®Ìèâ": { gen: 8800 }, "ÏòÅÍ¥ë": { gen: 12800 }, "Ïû•ÏÑ±": { gen: 7900 }, "ÏôÑÎèÑ": { gen: 23000 }, "ÏßÑÎèÑ": { gen: 20800 }, "ÎÇ®ÏïÖ": { gen: 12700 } },
            "Íµ¨Î°Ä": { "Í¥ëÏ£º": { gen: 9800 }, "Î™©Ìè¨": { gen: 17000 }, "Ïó¨Ïàò": { gen: 10200 }, "ÏàúÏ≤ú": { gen: 5200 }, "ÎÇòÏ£º": { gen: 14100 }, "Í¥ëÏñë": { gen: 7700 }, "Îã¥Ïñë": { gen: 12700 }, "Í≥°ÏÑ±": { gen: 4300 }, "Í≥†Ìù•": { gen: 13900 }, "Î≥¥ÏÑ±": { gen: 13100 }, "ÌôîÏàú": { gen: 12300 }, "Ïû•Ìù•": { gen: 16300 }, "Í∞ïÏßÑ": { gen: 11400 }, "Ìï¥ÎÇ®": { gen: 13700 }, "ÏòÅÏïî": { gen: 8700 }, "Î¨¥Ïïà": { gen: 6000 }, "Ìï®Ìèâ": { gen: 4500 }, "ÏòÅÍ¥ë": { gen: 7300 }, "Ïû•ÏÑ±": { gen: 2400 }, "ÏôÑÎèÑ": { gen: 20500 }, "ÏßÑÎèÑ": { gen: 15300 }, "ÎÇ®ÏïÖ": { gen: 7200 } },
            "Í≥†Ìù•": { "Í¥ëÏ£º": { gen: 16200, pre: 21000 }, "Î™©Ìè¨": { gen: 18600 }, "Ïó¨Ïàò": { gen: 13600 }, "ÏàúÏ≤ú": { gen: 8700 }, "ÎÇòÏ£º": { gen: 20500 }, "Í¥ëÏñë": { gen: 10200 }, "Îã¥Ïñë": { gen: 19100 }, "Í≥°ÏÑ±": { gen: 21400 }, "Íµ¨Î°Ä": { gen: 13900 }, "Î≥¥ÏÑ±": { gen: 9900 }, "ÌôîÏàú": { gen: 13700 }, "Ïû•Ìù•": { gen: 13100 }, "Í∞ïÏßÑ": { gen: 14200 }, "Ìï¥ÎÇ®": { gen: 18600 }, "ÏòÅÏïî": { gen: 19500 }, "Î¨¥Ïïà": { gen: 22200 }, "Ìï®Ìèâ": { gen: 20700 }, "ÏòÅÍ¥ë": { gen: 23500 }, "Ïû•ÏÑ±": { gen: 18600 }, "ÏôÑÎèÑ": { gen: 25200 }, "ÏßÑÎèÑ": { gen: 25900 }, "ÎÇ®ÏïÖ": { gen: 23400 } },
            "Î≥¥ÏÑ±": { "Í¥ëÏ£º": { gen: 10500, pre: 11500 }, "Î™©Ìè¨": { gen: 13500 }, "Ïó¨Ïàò": { gen: 12800 }, "ÏàúÏ≤ú": { gen: 7900 }, "ÎÇòÏ£º": { gen: 14800 }, "Í¥ëÏñë": { gen: 9900 }, "Îã¥Ïñë": { gen: 13400 }, "Í≥°ÏÑ±": { gen: 17300 }, "Íµ¨Î°Ä": { gen: 13100 }, "Í≥†Ìù•": { gen: 9900 }, "ÌôîÏàú": { gen: 7800 }, "Ïû•Ìù•": { gen: 3200 }, "Í∞ïÏßÑ": { gen: 5700 }, "Ìï¥ÎÇ®": { gen: 8700 }, "ÏòÅÏïî": { gen: 7800 }, "Î¨¥Ïïà": { gen: 16700 }, "Ìï®Ìèâ": { gen: 15000 }, "ÏòÅÍ¥ë": { gen: 17800 }, "Ïû•ÏÑ±": { gen: 12900 }, "ÏôÑÎèÑ": { gen: 15400 }, "ÏßÑÎèÑ": { gen: 16000 }, "ÎÇ®ÏïÖ": { gen: 13500 } },
            "ÌôîÏàú": { "Í¥ëÏ£º": { gen: 2500 }, "Î™©Ìè¨": { gen: 9700 }, "Ïó¨Ïàò": { gen: 15500 }, "ÏàúÏ≤ú": { gen: 9700 }, "ÎÇòÏ£º": { gen: 6800 }, "Í¥ëÏñë": { gen: 8000 }, "Îã¥Ïñë": { gen: 8000 }, "Í≥°ÏÑ±": { gen: 8000 }, "Íµ¨Î°Ä": { gen: 12300 }, "Í≥†Ìù•": { gen: 13700 }, "Î≥¥ÏÑ±": { gen: 7800 }, "Ïû•Ìù•": { gen: 10000 }, "Í∞ïÏßÑ": { gen: 11400 }, "Ìï¥ÎÇ®": { gen: 16500 }, "ÏòÅÏïî": { gen: 11200 }, "Î¨¥Ïïà": { gen: 8500 }, "Ìï®Ìèâ": { gen: 7000 }, "ÏòÅÍ¥ë": { gen: 9800 }, "Ïû•ÏÑ±": { gen: 4900 }, "ÏôÑÎèÑ": { gen: 23000 }, "ÏßÑÎèÑ": { gen: 17800 }, "ÎÇ®ÏïÖ": { gen: 9700 } },
            "Ïû•Ìù•": { "Í¥ëÏ£º": { gen: 11500, pre: 14900 }, "Î™©Ìè¨": { gen: 10200 }, "Ïó¨Ïàò": { gen: 16100 }, "ÏàúÏ≤ú": { gen: 11100 }, "ÎÇòÏ£º": { gen: 9000 }, "Í¥ëÏñë": { gen: 13200 }, "Îã¥Ïñë": { gen: 14400 }, "Í≥°ÏÑ±": { gen: 17000 }, "Íµ¨Î°Ä": { gen: 16300 }, "Í≥†Ìù•": { gen: 13100 }, "Î≥¥ÏÑ±": { gen: 3200 }, "ÌôîÏàú": { gen: 10000 }, "Í∞ïÏßÑ": { gen: 2400 }, "Ìï¥ÎÇ®": { gen: 5400 }, "ÏòÅÏïî": { gen: 4600 }, "Î¨¥Ïïà": { gen: 8500 }, "Ìï®Ìèâ": { gen: 2500 }, "ÏòÅÍ¥ë": { gen: 5500 }, "Ïû•ÏÑ±": { gen: 8400 }, "ÏôÑÎèÑ": { gen: 2300 }, "ÏßÑÎèÑ": { gen: 12700 }, "ÎÇ®ÏïÖ": { gen: 9700 } },
            "Í∞ïÏßÑ": { "Í¥ëÏ£º": { gen: 11700, pre: 15200 }, "Î™©Ìè¨": { gen: 7800 }, "Ïó¨Ïàò": { gen: 18500 }, "ÏàúÏ≤ú": { gen: 13500 }, "ÎÇòÏ£º": { gen: 8200 }, "Í¥ëÏñë": { gen: 12700 }, "Îã¥Ïñë": { gen: 14600 }, "Í≥°ÏÑ±": { gen: 17200 }, "Íµ¨Î°Ä": { gen: 11400 }, "Ìï¥ÎÇ®": { gen: 3000 }, "ÏòÅÏïî": { gen: 8700 }, "Î¨¥Ïïà": { gen: 6000 }, "Ìï®Ìèâ": { gen: 4500 }, "ÏòÅÍ¥ë": { gen: 7300 }, "Ïû•ÏÑ±": { gen: 2400 }, "ÏôÑÎèÑ": { gen: 20500 }, "ÏßÑÎèÑ": { gen: 15300 }, "ÎÇ®ÏïÖ": { gen: 7200 } },
            "Ìï¥ÎÇ®": { "Í¥ëÏ£º": { gen: 13700, pre: 16900 }, "Î™©Ìè¨": { gen: 8700 }, "Ïó¨Ïàò": { gen: 21500 }, "ÏàúÏ≤ú": { gen: 16600 }, "ÎÇòÏ£º": { gen: 9900 }, "Í¥ëÏñë": { gen: 19100 }, "Îã¥Ïñë": { gen: 16600 }, "Í≥°ÏÑ±": { gen: 19200 }, "Íµ¨Î°Ä": { gen: 21800 }, "Í≥†Ìù•": { gen: 18600 }, "Î≥¥ÏÑ±": { gen: 8700 }, "ÌôîÏàú": { gen: 16500 }, "Ïû•Ìù•": { gen: 5400 }, "Í∞ïÏßÑ": { gen: 3000 }, "ÏòÅÏïî": { gen: 4900 }, "Î¨¥Ïïà": { gen: 8500 }, "Ìï®Ìèâ": { gen: 7000 }, "ÏòÅÍ¥ë": { gen: 9800 }, "Ïû•ÏÑ±": { gen: 4900 }, "ÏôÑÎèÑ": { gen: 6700, pre: 8200 }, "ÏßÑÎèÑ": { gen: 7300 }, "ÎÇ®ÏïÖ": { gen: 8500 } },
            "ÏòÅÏïî": { "Í¥ëÏ£º": { gen: 8700 }, "Î™©Ìè¨": { gen: 6400 }, "Ïó¨Ïàò": { gen: 22400 }, "ÏàúÏ≤ú": { gen: 17500 }, "ÎÇòÏ£º": { gen: 4400 }, "Í¥ëÏñë": { gen: 19500 }, "Îã¥Ïñë": { gen: 11600 }, "Í≥°ÏÑ±": { gen: 14200 }, "Íµ¨Î°Ä": { gen: 18500 }, "Í≥†Ìù•": { gen: 19500 }, "Î≥¥ÏÑ±": { gen: 7800 }, "ÌôîÏàú": { gen: 11200 }, "Ïû•Ìù•": { gen: 4600 }, "Í∞ïÏßÑ": { gen: 3900 }, "Ìï¥ÎÇ®": { gen: 4900 }, "Î¨¥Ïïà": { gen: 9600 }, "Ìï®Ìèâ": { gen: 7700 }, "ÏòÅÍ¥ë": { gen: 11800 }, "Ïû•ÏÑ±": { gen: 11100 }, "ÏôÑÎèÑ": { gen: 11600 }, "ÏßÑÎèÑ": { gen: 10300 }, "ÎÇ®ÏïÖ": { gen: 3700 } },
            "Î¨¥Ïïà": { "Í¥ëÏ£º": { gen: 6000, pre: 7800 }, "Î™©Ìè¨": { gen: 3200 }, "Ïó¨Ïàò": { gen: 19000 }, "ÏàúÏ≤ú": { gen: 14700, pre: 18200 }, "ÎÇòÏ£º": { gen: 4100 }, "Í¥ëÏñë": { gen: 14400 }, "Îã¥Ïñë": { gen: 8900 }, "Í≥°ÏÑ±": { gen: 11500 }, "Íµ¨Î°Ä": { gen: 15800 }, "Í≥†Ìù•": { gen: 22200 }, "Î≥¥ÏÑ±": { gen: 16700 }, "ÌôîÏàú": { gen: 8500 }, "Ïû•Ìù•": { gen: 13400 }, "Í∞ïÏßÑ": { gen: 11000 }, "Ìï¥ÎÇ®": { gen: 11900 }, "ÏòÅÏïî": { gen: 9600 }, "Ìï®Ìèâ": { gen: 2500 }, "ÏòÅÍ¥ë": { gen: 5500 }, "Ïû•ÏÑ±": { gen: 8400 }, "ÏôÑÎèÑ": { gen: 18900 }, "ÏßÑÎèÑ": { gen: 11500 }, "ÎÇ®ÏïÖ": { gen: 3700 } },
            "Ìï®Ìèâ": { "Í¥ëÏ£º": { gen: 4500, pre: 5800 }, "Î™©Ìè¨": { gen: 5100 }, "Ïó¨Ïàò": { gen: 17500 }, "ÏàúÏ≤ú": { gen: 12900 }, "ÎÇòÏ£º": { gen: 3700 }, "Í¥ëÏñë": { gen: 12900 }, "Îã¥Ïñë": { gen: 7400 }, "Í≥°ÏÑ±": { gen: 8800 }, "Íµ¨Î°Ä": { gen: 14300 }, "Í≥†Ìù•": { gen: 20700 }, "Î≥¥ÏÑ±": { gen: 15000 }, "ÌôîÏàú": { gen: 7000 }, "Ïû•Ìù•": { gen: 15300 }, "Í∞ïÏßÑ": { gen: 11600 }, "Ìï¥ÎÇ®": { gen: 13800 }, "ÏòÅÏïî": { gen: 7700 }, "Î¨¥Ïïà": { gen: 2500 }, "ÏòÅÍ¥ë": { gen: 3600 }, "Ïû•ÏÑ±": { gen: 6900 }, "ÏôÑÎèÑ": { gen: 20800 }, "ÏßÑÎèÑ": { gen: 13400 }, "ÎÇ®ÏïÖ": { gen: 6800 } },
            "ÏòÅÍ¥ë": { "Í¥ëÏ£º": { gen: 7300, pre: 9500 }, "Î™©Ìè¨": { gen: 8700 }, "Ïó¨Ïàò": { gen: 20300 }, "ÏàúÏ≤ú": { gen: 15700 }, "ÎÇòÏ£º": { gen: 7400 }, "Í¥ëÏñë": { gen: 15700 }, "Îã¥Ïñë": { gen: 10200 }, "Í≥°ÏÑ±": { gen: 12800 }, "Íµ¨Î°Ä": { gen: 17100 }, "Í≥†Ìù•": { gen: 23500 }, "Î≥¥ÏÑ±": { gen: 17800 }, "ÌôîÏàú": { gen: 9800 }, "Ïû•Ìù•": { gen: 18900 }, "Í∞ïÏßÑ": { gen: 16500 }, "Ìï¥ÎÇ®": { gen: 17400 }, "ÏòÅÏïî": { gen: 11800 }, "Î¨¥Ïïà": { gen: 5500 }, "Ìï®Ìèâ": { gen: 3600 }, "Ïû•ÏÑ±": { gen: 5900 }, "ÏôÑÎèÑ": { gen: 24400 }, "ÏßÑÎèÑ": { gen: 17000 }, "ÎÇ®ÏïÖ": { gen: 8700 } },
            "Ïû•ÏÑ±": { "Í¥ëÏ£º": { gen: 2400 }, "Î™©Ìè¨": { gen: 9600 }, "Ïó¨Ïàò": { gen: 10800 }, "ÏàúÏ≤ú": { gen: 6700 }, "ÎÇòÏ£º": { gen: 10800 }, "Í¥ëÏñë": { gen: 5300 }, "Îã¥Ïñë": { gen: 7900 }, "Í≥°ÏÑ±": { gen: 12200 }, "Íµ¨Î°Ä": { gen: 18600 }, "Í≥†Ìù•": { gen: 12900 }, "Î≥¥ÏÑ±": { gen: 4900 }, "ÌôîÏàú": { gen: 13900 }, "Ïû•Ìù•": { gen: 14100 }, "Í∞ïÏßÑ": { gen: 16100 }, "Ìï¥ÎÇ®": { gen: 11100 }, "ÏòÅÏïî": { gen: 8400 }, "Î¨¥Ïïà": { gen: 6900 }, "Ìï®Ìèâ": { gen: 5900 }, "ÏòÅÍ¥ë": { gen: 9700 }, "ÏôÑÎèÑ": { gen: 22900 }, "ÏßÑÎèÑ": { gen: 14000 }, "ÎÇ®ÏïÖ": { gen: 15500 } },
            "ÏôÑÎèÑ": { "Í¥ëÏ£º": { gen: 20500, pre: 24800 }, "Î™©Ìè¨": { gen: 15700 }, "Ïó¨Ïàò": { gen: 28200 }, "ÏàúÏ≤ú": { gen: 23200 }, "ÎÇòÏ£º": { gen: 16600 }, "Í¥ëÏñë": { gen: 25800 }, "Îã¥Ïñë": { gen: 23400 }, "Í≥°ÏÑ±": { gen: 23000 }, "Íµ¨Î°Ä": { gen: 28400 }, "Í≥†Ìù•": { gen: 25200 }, "Î≥¥ÏÑ±": { gen: 15400 }, "ÌôîÏàú": { gen: 23000 }, "Ïû•Ìù•": { gen: 12100 }, "Í∞ïÏßÑ": { gen: 7300 }, "Ìï¥ÎÇ®": { gen: 6700, pre: 8200 }, "ÏòÅÏïî": { gen: 11600 }, "Î¨¥Ïïà": { gen: 18900 }, "Ìï®Ìèâ": { gen: 20800 }, "ÏòÅÍ¥ë": { gen: 22900 }, "Ïû•ÏÑ±": { gen: 22900 }, "ÏßÑÎèÑ": { gen: 14000 }, "ÎÇ®ÏïÖ": { gen: 10100 } },
            "ÏßÑÎèÑ": { "Í¥ëÏ£º": { gen: 15300, pre: 19900 }, "Î™©Ìè¨": { gen: 8300, pre: 10800 }, "Ïó¨Ïàò": { gen: 24800 }, "ÏàúÏ≤ú": { gen: 23900 }, "ÎÇòÏ£º": { gen: 17200 }, "Í¥ëÏñë": { gen: 23400 }, "Îã¥Ïñë": { gen: 18200 }, "Í≥°ÏÑ±": { gen: 20800 }, "Íµ¨Î°Ä": { gen: 11400 }, "Ìï¥ÎÇ®": { gen: 7300 }, "ÏòÅÏïî": { gen: 10300 }, "Î¨¥Ïïà": { gen: 11500 }, "Ìï®Ìèâ": { gen: 13400 }, "ÏòÅÍ¥ë": { gen: 17000 }, "Ïû•ÏÑ±": { gen: 17700 }, "ÏôÑÎèÑ": { gen: 14000 }, "ÎÇ®ÏïÖ": { gen: 10100 } },
            "ÎÇ®ÏïÖ": { "Í¥ëÏ£º": { gen: 7200, pre: 9300 }, "Î™©Ìè¨": { gen: 1700 }, "Ïó¨Ïàò": { gen: 15600, pre: 20200 }, "ÏàúÏ≤ú": { gen: 10600, pre: 13800 }, "ÎÇòÏ£º": { gen: 9000 }, "Í¥ëÏñë": { gen: 11700 }, "Îã¥Ïñë": { gen: 10100 }, "Í≥°ÏÑ±": { gen: 12700 }, "Íµ¨Î°Ä": { gen: 19000 }, "Í≥†Ìù•": { gen: 23400 }, "Î≥¥ÏÑ±": { gen: 13500 }, "ÌôîÏàú": { gen: 9700 }, "Ïû•Ìù•": { gen: 10000 }, "Í∞ïÏßÑ": { gen: 7600 }, "Ìï¥ÎÇ®": { gen: 8500 }, "ÏòÅÏïî": { gen: 3700 }, "Î¨¥Ïïà": { gen: 3700 }, "Ìï®Ìèâ": { gen: 2500 }, "ÏòÅÍ¥ë": { gen: 5500 }, "Ïû•ÏÑ±": { gen: 8400 }, "ÏôÑÎèÑ": { gen: 18900 }, "ÏßÑÎèÑ": { gen: 11500 } } 
        };

        const ALLOWED_CITIES = Object.keys(REGION_ICONS);
        const CHOSUNG = ["„Ñ±","„Ñ≤","„Ñ¥","„Ñ∑","„Ñ∏","„Ñπ","„ÖÅ","„ÖÇ","„ÖÉ","„ÖÖ","„ÖÜ","„Öá","„Öà","„Öâ","„Öä","„Öã","„Öå","„Öç","„Öé"];
        const COMPLEX_JAMO_MAP = {'„Ñ≥':'„Ñ±„ÖÖ','„Ñµ':'„Ñ¥„Öà','„Ñ∂':'„Ñ¥„Öé','„Ñ∫':'„Ñπ„Ñ±','„Ñª':'„Ñπ„ÖÅ','„Ñº':'„Ñπ„ÖÇ','„ÑΩ':'„Ñπ„ÖÖ','„Ñæ':'„Ñπ„Öå','„Ñø':'„Ñπ„Öç','„ÖÄ':'„Ñπ„Öé','„ÖÑ':'„ÖÇ„ÖÖ'};

        const getChosungStr = (str) => { if (!str) return ""; let result = ""; for (let i = 0; i < str.length; i++) { const code = str.charCodeAt(i) - 44032; if (code > -1 && code < 11172) result += CHOSUNG[Math.floor(code / 588)]; else result += str.charAt(i); } return result; };
        const resolveComplexJamo = (str) => { let result = ""; for (let char of str) { result += COMPLEX_JAMO_MAP[char] || char; } return result; };
        const normalize = (str) => (str || '').trim().replace(/\s/g, "");
        const fmt = (num) => Number(num).toLocaleString('ko-KR');
        
        const getTagStyles = (tag) => { 
            const map = { 
                'ÏûêÍ∞ÄÏö©': 'bg-gray-100 text-gray-700 border-gray-200', 
                'Í¥ÄÏö©Ï∞®': 'bg-[#FFFBEB] text-[#D97706] border-[#FDE68A]', 
                'ÎãπÏùº': 'bg-gray-100 text-[#1C1C1E] border-gray-200', 
                'ÏôïÎ≥µ': 'bg-gray-100 text-gray-500 border-gray-200', 
                'Ïó¨Í∞ùÏÑ†': 'bg-[#E0F2FE] text-[#0284C7] border-[#BAE6FD]', 
                'ÎÜçÏñ¥Ï¥åÎ≤ÑÏä§': 'bg-[#D1FAE5] text-[#059669] border-[#A7F3D0]', 
                'Ìé∏ÎèÑ': 'bg-gray-100 text-gray-500 border-gray-200' 
            }; 
            return map[tag] || 'bg-gray-50 text-gray-600 border-gray-100'; 
        };

        const { useState, useEffect } = React;

        const AutocompleteInput = ({ value, onChange, onSelect, placeholder, label, cityList }) => {
            const [suggestions, setSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [activeIndex, setActiveIndex] = useState(-1);
            useEffect(() => { const inputVal = (value || '').trim(); if (!inputVal || cityList.includes(inputVal)) { setSuggestions([]); return; } const resolved = resolveComplexJamo(inputVal); const isChosung = /^[„Ñ±-„Öé]+$/.test(resolved); let exact = cityList.filter(city => { if (isChosung) return getChosungStr(city).includes(resolved); return city.includes(inputVal); }); setSuggestions(exact.length > 0 ? exact : []); }, [value, cityList]);
            const handleSelect = (city) => { onSelect(city); setShowSuggestions(false); setSuggestions([]); setActiveIndex(-1); };
            const handleKeyDown = (e) => { if (e.key === 'ArrowDown') { e.preventDefault(); if (suggestions.length > 0) setActiveIndex(prev => (prev < suggestions.length - 1 ? prev + 1 : 0)); } else if (e.key === 'ArrowUp') { e.preventDefault(); if (suggestions.length > 0) setActiveIndex(prev => (prev > 0 ? prev - 1 : suggestions.length - 1)); } else if (e.key === 'Enter') { if (e.nativeEvent.isComposing) return; if (activeIndex >= 0) handleSelect(suggestions[activeIndex]); else if (suggestions.length > 0) handleSelect(suggestions[0]); } };
            return (
                <div className="relative w-full group">
                    <div className="input-group">
                        <Icons.MapPin className="text-gray-400 group-focus-within:text-[#8B0000] transition-colors shrink-0" />
                        <div className="flex-1 min-w-0">
                            {label && <label className="block text-[11px] font-bold text-gray-500 uppercase tracking-tighter mb-0.5">{label}</label>}
                            <input type="text" className="w-full bg-transparent outline-none font-gmarket font-bold text-gray-900 text-2xl placeholder-gray-300" placeholder={placeholder} value={value || ''} onChange={e => { onChange(e.target.value); setShowSuggestions(true); }} onClick={() => { if (value) { onChange(''); onSelect(''); } }} onFocus={() => setShowSuggestions(true)} onBlur={() => setTimeout(() => setShowSuggestions(false), 200)} onKeyDown={handleKeyDown} autoComplete="off" />
                        </div>
                        <div className="w-14 flex justify-center items-center shrink-0 pt-2">{value && REGION_ICONS[value.replace(/\s/g, "")] && <span className="text-4xl icon-bounce">{REGION_ICONS[value.replace(/\s/g, "")]}</span>}</div>
                    </div>
                    {showSuggestions && suggestions.length > 0 && (
                        <div className="suggestions-box custom-scroll">
                            {suggestions.map((city, idx) => (
                                <div key={city} onMouseDown={() => handleSelect(city)} onMouseEnter={() => setActiveIndex(idx)} className={`suggestion-item ${idx === activeIndex ? 'active' : ''}`}>
                                    <span className="text-[16px] font-bold">{city}</span><span className="text-2xl">{REGION_ICONS[city.replace(/\s/g, "")]}</span>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const Toggle = ({ checked, onChange }) => (
            <button onClick={() => onChange(!checked)} className={`toggle-switch ${checked ? 'toggle-active' : 'toggle-inactive'}`}>
                <span className={`toggle-knob ${checked ? 'knob-active' : ''}`} />
            </button>
        );

        const App = () => {
            const [origin, setOrigin] = useState('');
            const [destination, setDestination] = useState('');
            const [result, setResult] = useState(null);
            const [modalState, setModalState] = useState({ type: null, data: [] });
            const [showDetail, setShowDetail] = useState(false);
            const [shipFare, setShipFare] = useState(0); 
            const [manualMainTransport, setManualMainTransport] = useState(null); 
            const [intraCityOpen, setIntraCityOpen] = useState(false);
            const [intraDeductions, setIntraDeductions] = useState({ shortTime: false, govVehicle: false });
            const [activeModal, setActiveModal] = useState(null); 
            const [deductions, setDeductions] = useState({ gov_vehicle: false, meal_1: false, meal_2: false, meal_3: false, meal_half: false, transport_proof: false, transport_gov_vehicle: false, transport_passenger: false });
            const [showHistory, setShowHistory] = useState(false);
            const [history, setHistory] = useState(() => { try { return JSON.parse(localStorage.getItem('yeobi_history') || '[]'); } catch { return []; } });
            const [calcStatus, setCalcStatus] = React.useState('idle'); // 'idle' | 'working' | 'done'

            // Î°úÏßÅ Ï†àÎåÄ Î≥¥Ï°¥ Íµ¨Ïó≠
            const calculateDetailedCost = () => { if (!result) return { total: 0 }; let daily = deductions.gov_vehicle ? 12500 : 25000; let meal = deductions.meal_3 ? 0 : deductions.meal_1 ? 16670 : deductions.meal_2 ? 8330 : deductions.meal_half ? 12500 : 25000; let transport = (deductions.transport_proof || deductions.transport_gov_vehicle || deductions.transport_passenger) ? 0 : (result.type === 'internal' ? (manualMainTransport || 0) : 0); return { daily, meal, transport, total: daily + meal + transport + (shipFare || 0) }; };

            const performCalculation = (o = origin, d = destination, isForce = false) => {
                const from = normalize(o); const to = normalize(d);
                setDeductions({ gov_vehicle: false, meal_1: false, meal_2: false, meal_3: false, meal_half: false, transport_proof: false, transport_gov_vehicle: false, transport_passenger: false });
                setShipFare(0); setManualMainTransport(null); setShowDetail(false);
                if (from && to) setCalcStatus('working');
                const fromNormalized = o.replace(/\s/g, ""); const toNormalized = d.replace(/\s/g, "");
                if (!isForce) { if (POPUP_REGIONS[fromNormalized] && !modalState.type) { setModalState({ type: 'origin', data: POPUP_REGIONS[fromNormalized] }); return; } if (POPUP_REGIONS[toNormalized] && !modalState.type) { setModalState({ type: 'destination', data: POPUP_REGIONS[toNormalized] }); return; } }
                if (!from || !to) return;
                for (const group of SAME_AREA_GROUPS) { if (group.has(from) && group.has(to)) { setIntraCityOpen(true); return; } }
                const fromIsland = ISLAND_DB[from]; const toIsland = ISLAND_DB[to];
                let searchFrom = from; let searchTo = to; let surcharge = 0; let shipSurcharge = 0; let islandConfig = null; let viaPoint = null;
                if (fromIsland) { searchFrom = fromIsland.hub; shipSurcharge += (fromIsland.shipCost || 0); islandConfig = fromIsland; viaPoint = fromIsland.via || fromIsland.hub; }
                if (toIsland) { searchTo = toIsland.hub; shipSurcharge += (toIsland.shipCost || 0); islandConfig = toIsland; viaPoint = toIsland.via || toIsland.hub; }
                
                surcharge = (fromIsland?.cost || 0) + (toIsland?.cost || 0);

                const baseData = INITIAL_DATA[searchFrom]?.[searchTo] || INITIAL_DATA[searchTo]?.[searchFrom];
                if (baseData || (searchFrom === searchTo)) { 
                    const finalGen = (baseData?.gen || 0) + surcharge; 
                    const finalPre = baseData?.pre ? baseData.pre + surcharge : null; 
                    const finalCost = finalPre ? finalPre : finalGen; 
                    setShipFare(shipSurcharge * 2); 
                    setManualMainTransport(finalCost * 2); 
                    const newResult = { type: 'internal', cost: finalCost, baseBusCost: baseData?.pre || baseData?.gen || 0, surcharge, shipCost: shipSurcharge, isShipOnlyRoute: islandConfig?.type === 'ship', viaPoint };
                    setResult(newResult);
                    setTimeout(() => setCalcStatus('done'), 300);
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï†ÄÏû• (Ïú†Ìö®Ìïú Í¥ÄÏô∏ Í≤∞Í≥ºÎßå)
                    if (o && d) {
                        setHistory(prev => {
                            const entry = { origin: o, destination: d, cost: finalCost, ts: Date.now() };
                            const filtered = prev.filter(h => !(h.origin === o && h.destination === d));
                            const next = [entry, ...filtered].slice(0, 3);
                            try { localStorage.setItem('yeobi_history', JSON.stringify(next)); } catch {}
                            return next;
                        });
                    }
                } else { setResult({ type: 'external' }); setTimeout(() => setCalcStatus('done'), 300); }
            };

            const detailCosts = calculateDetailedCost(); 

            const routeTags = (() => { const tags = []; if (!result || result.type !== 'internal') return tags; tags.push(deductions.gov_vehicle ? 'Í¥ÄÏö©Ï∞®' : 'ÏûêÍ∞ÄÏö©', "ÎãπÏùº", "ÏôïÎ≥µ"); const isWandoConnected = (l) => ISLAND_DB[l]?.hub === 'ÏôÑÎèÑ' && ISLAND_DB[l]?.type === 'connected'; 
                if (((ISLAND_DB[origin]?.type === 'connected' && !isWandoConnected(origin)) || (ISLAND_DB[destination]?.type === 'connected' && !isWandoConnected(destination))) || (result.surcharge > 0)) {
                    tags.push("ÎÜçÏñ¥Ï¥åÎ≤ÑÏä§");
                }
                if (result.viaPoint) tags.push(`${result.viaPoint} Í≤ΩÏú†`); if (result.shipCost > 0 || result.isShipOnlyRoute) tags.push("Ïó¨Í∞ùÏÑ†"); return tags; 
            })();

            const getModalContent = (key) => {
                const destTag = <span className="inline-block px-1.5 py-0.5 mx-1 bg-[#1C1C1E] text-white rounded border border-[#1C1C1E] font-bold align-top relative -top-0.5 text-[10px] leading-none">{destination}</span>;
                if (key === 'daily') { return { title: "ÏùºÎπÑ", desc: <span>Ï∂úÏû•ÏßÄ{destTag} ÎÇ¥ÏóêÏÑú ÏÜåÏöîÎêòÎäî ÌòÑÏßÄ ÍµêÌÜµÎπÑ, ÌÜµÏã†ÎπÑ, ÏùåÎ£åÎπÑ Îì± Ïó¨Ìñâ Ï§ë Î∞úÏÉùÌïòÎäî Í∞ÅÏ¢Ö ÏÜåÏï°Ïùò Í≤ΩÎπÑÎ•º Ï∂©ÎãπÌïòÍ∏∞ ÏúÑÌïú Í≤ΩÎπÑ</span>, items: [ { id: 'gov_vehicle', label: "Í≥µÏö©Ï∞®Îüâ¬∑ÏûÑÏ∞®Ï∞®Îüâ(Ï†ÑÏÑ∏Î≤ÑÏä§ Îì±)ÏùÑ Ïù¥Ïö©", subLabel: "" } ] }; }
                if (key === 'meal') { return { title: "ÏãùÎπÑ", desc: "Ïó¨Ìñâ(Ï∂úÏû•) Ï§ë ÏãùÏÇ¨Ïóê ÏÜåÏöîÎêòÎäî ÎπÑÏö©. Î∞•ÏùÑ Î®πÏùÑ ÌïÑÏöîÍ∞Ä ÏóÜÍ±∞ÎÇò Îã§Î•∏ ÎèàÏúºÎ°ú Î∞•ÏùÑ Î®πÏóàÏùÑ Îïå Í∞êÏï°.", items: [ { id: 'meal_1', label: "1Ïãù Í∞êÏï°", subLabel: "" }, { id: 'meal_2', label: "2Ïãù Í∞êÏï°", subLabel: "" }, { id: 'meal_3', label: "Ï†ÑÏï° Í∞êÏï°", subLabel: "" }, { id: 'meal_half', label: "¬Ω Í∞êÏï°", subLabel: "" } ] }; }
                if (key === 'transport') { return { title: "ÍµêÌÜµÎπÑ", desc: <span>Í∑ºÎ¨¥ÏßÄÏóêÏÑú Ï∂úÏû• Î™©Ï†ÅÏßÄ{destTag}Î°ú Ïù¥ÎèôÌïòÍ∏∞ ÏúÑÌï¥ ÏÜåÏöîÎêòÎäî ÍµêÌÜµÏàòÎã®Ïùò ÎπÑÏö©</span>, items: [ { id: 'transport_proof', label: "Ï¶ùÍ±∞ÏÑúÎ•ò ÎØ∏Ï†úÏ∂ú¬∑Î∂ÄÏ†ÅÏ†ï" }, { id: 'transport_gov_vehicle', label: "Í≥µÏö©/ÏûÑÏ∞®Ï∞®Îüâ Ïù¥Ïö©" }, { id: 'transport_passenger', label: "ÎèôÎ£å Ï∞®Îüâ ÎèôÏäπ", subLabel: "ÎèôÏäπÏûê ÍµêÌÜµÎπÑ ÎØ∏ÏßÄÍ∏â" } ] }; }
            };

            const getMealDeductionLabel = () => { if (deductions.meal_1) return "(-8,330)"; if (deductions.meal_2) return "(-16,670)"; if (deductions.meal_3) return "(-25,000)"; if (deductions.meal_half) return "(-12,500)"; return ""; };

            return (
                <div className="main-wrapper font-pretendard">
                    <header className="header-teal">
                        <div className="flex flex-col"><h1 className="font-gmarket font-black text-[#8B0000] tracking-tighter" style={{fontSize:'22px'}}>yeobi-easy</h1><p className="font-bold text-gray-500 tracking-tight" style={{fontSize:'10px',marginTop:'1px'}}>by jhn ¬∑ for all my fellas</p></div>
                        <div className="mode-switch-container" onClick={() => { setIntraCityOpen(!intraCityOpen); setShowDetail(false); }}><div className={`mode-switch-slider ${intraCityOpen ? 'intra' : 'extra'}`}></div><div className={`mode-text ${!intraCityOpen ? 'active' : 'inactive'}`}>Í¥ÄÏô∏</div><div className={`mode-text ${intraCityOpen ? 'active' : 'inactive'}`}>Í¥ÄÎÇ¥</div></div>
                    </header>
                    <div className="scroll-area content-main px-5 pt-8 pb-8 space-y-5">
                        <AutocompleteInput label="Ï∂úÎ∞úÏßÄ" placeholder="Ï∂úÎ∞úÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî." value={origin} onChange={setOrigin} onSelect={(city) => { setOrigin(city); performCalculation(city, destination); }} cityList={ALLOWED_CITIES} />
                        <AutocompleteInput label="ÎèÑÏ∞©ÏßÄ" placeholder="ÎèÑÏ∞©ÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî." value={destination} onChange={setDestination} onSelect={(city) => { setDestination(city); performCalculation(origin, city); }} cityList={ALLOWED_CITIES} />
                        
                        {/* ‚îÄ‚îÄ ÏÉÅÌÉú Î™®ÎãàÌÑ∞ Î≤ÑÌäº ‚îÄ‚îÄ */}
                        {calcStatus === 'idle' && (
                            <div className="status-bar-idle">
                                <span style={{fontSize:'13px'}}>‚óã</span>
                                <span>Ïòà: Ïã†Ïïà, Îã¥Ïñë, Ìï¥ÎÇ® Îì±(+ Ï¥àÏÑ± ÏûÖÎ†• ÌõÑ ÏÑ†ÌÉù Í∞ÄÎä•)</span>
                            </div>
                        )}
                        {calcStatus === 'working' && (
                            <div className="status-bar-working">
                                <div className="dots-anim">
                                    <span/><span/><span/>
                                </div>
                                <span>2026.1.1.Ïûê Íµ≠ÎÇ¥Ïó¨ÎπÑÍ∏∞Ï§ÄÌëú Ï°∞Ìöå Ï§ë</span>
                            </div>
                        )}
                        {calcStatus === 'done' && (
                            <div className="status-bar-done">
                                <span style={{fontSize:'13px', color:'#8B0000'}}>‚úì</span>
                                <span>crafted with passion by jhn@usyes</span>
                            </div>
                        )}

                        <div className="pb-6 bg-white mt-4 rounded-[32px] overflow-hidden flex flex-col" style={{background: 'linear-gradient(180deg, #FFFFFF 0%, #FAFAFA 100%)', boxShadow: '0 4px 16px rgba(0,0,0,0.04), 0 8px 32px rgba(0,0,0,0.02), inset 0 1px 0 rgba(255,255,255,1)', border: '1px solid rgba(0,0,0,0.04)'}}>
                            <div className="text-center pt-5 px-4 flex-1">
                                <div className="flex justify-between items-center h-10 px-2">
                                    <div className="flex items-center">
                                        <span className="font-bold text-[#1C1C1E] text-xl">ÏöîÍ∏à</span>
                                        {result && <span className={`tag-side ${getTagStyles('Ìé∏ÎèÑ')}`}>Ìé∏ÎèÑ</span>}
                                    </div>
                                    <span className="text-3xl font-extrabold text-[#8B0000] font-suit">
                                        {result ? `${fmt(result.type === 'internal' ? (result.surcharge > 0 ? result.baseBusCost : result.cost) : 0)}Ïõê` : ''}
                                    </span>
                                </div>
                                
                                {result && result.type === 'internal' && result.surcharge > 0 && (<div className="flex justify-between items-center h-8 px-2 mt-1"><div className="flex items-center"><span className="font-bold text-[#059669] text-[15px]">ÎÜçÏñ¥Ï¥åÎ≤ÑÏä§</span><span className={`tag-side ${getTagStyles('Ìé∏ÎèÑ')}`}>Ìé∏ÎèÑ</span></div><span className="text-[17px] font-bold text-[#059669] font-suit">{fmt(result.surcharge)}Ïõê</span></div>)}
                                {result && result.type === 'internal' && result.shipCost > 0 && (<div className="flex justify-between items-center h-8 px-2 mt-1"><div className="flex items-center"><span className="font-bold text-[#0284C7] text-[15px]">Ïó¨Í∞ùÏÑ†</span><span className={`tag-side ${getTagStyles('Ìé∏ÎèÑ')}`}>Ìé∏ÎèÑ</span></div><span className="text-[17px] font-bold text-[#0284C7] font-suit">{fmt(result.shipCost)}Ïõê</span></div>)}
                                
                                <div className="pb-1 pt-3 flex flex-wrap justify-center gap-1.5 min-h-[32px]">
                                    {result && routeTags.map((tag, i) => (<span key={i} className={`tag-badge px-2.5 py-1 text-[13px] ${getTagStyles(tag)}`}>{tag}</span>))}
                                </div>
                                
                                <div className="flex gap-2.5 mt-5">
                                    <a href="https://padlet.com/jbyhee/hyonu-s-padlet-4m26339lwedx23dc" target="_blank" rel="noopener noreferrer" className="flex-1 h-[56px] border border-[#E5E0D6] text-[#1C1C1E] rounded-[16px] flex flex-col items-center justify-center no-underline transition-all" style={{background: 'linear-gradient(180deg, #F7F2E8 0%, #F5F0E6 100%)', boxShadow: '0 2px 4px rgba(0,0,0,0.03), inset 0 1px 0 rgba(255,255,255,0.8)'}}>
                                        <div className="flex items-center gap-1.5">
                                            <Icons.Send size={15} className="text-[#8B0000]" />
                                            <span className="text-[13px] font-bold">ÌîºÎìúÎ∞± ÎÇ®Í∏∞Í∏∞</span>
                                        </div>
                                        <span className="text-[9px] font-medium text-gray-500 mt-0.5">to jhn@usyes</span>
                                    </a>
                                    <button onClick={() => { if(result) setShowDetail(true); }} disabled={!result} className={`flex-1 h-[56px] rounded-[16px] font-bold text-[15px] flex items-center justify-center gap-1.5 transition-all ${result ? 'text-white' : 'bg-gray-100 text-gray-400 cursor-not-allowed border border-gray-200'}`} style={result ? {background: 'linear-gradient(180deg, #9B1111 0%, #8B0000 50%, #7A0000 100%)', boxShadow: '0 4px 12px rgba(139,0,0,0.25), 0 2px 4px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.15)'} : {}}>
                                        <Icons.Calculator size={18} className={result ? "text-[#F5A623]" : "text-gray-300"} /><span>Ïó¨ÎπÑ Í≥ÑÏÇ∞</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* ‚îÄ‚îÄ ÏïÑÏù¥Ìè∞ ÌÅ¥ÎûòÏãù ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ‚îÄ‚îÄ */}
                    <nav className="bottom-nav">
                        {/* ÏôºÏ™Ω: Í≥µÏÇ¨Ï§ë ‚Äì ÏÉà Î≤ÑÏ†Ñ Ï§ÄÎπÑÏ§ë */}
                        <a href="https://hyonu1.github.io/yeobi-easier/" target="_blank" rel="noopener noreferrer" className="nav-btn" style={{textDecoration:'none'}}>
                            <span style={{fontSize:'24px', lineHeight:1}}>‚ùî</span>
                        </a>

                        {/* Ï§ëÏïô: ÌÅ¥ÎûòÏãù ÌôàÎ≤ÑÌäº */}
                        <div className="home-btn-wrap" onClick={() => {
                            setDestination(''); setResult(null); setShipFare(0); setManualMainTransport(null); setShowDetail(false);
                            setDeductions({ gov_vehicle: false, meal_1: false, meal_2: false, meal_3: false, meal_half: false, transport_proof: false, transport_gov_vehicle: false, transport_passenger: false });
                            setShowHistory(false); setCalcStatus('idle');
                        }}>
                            <div className="home-btn" />
                        </div>

                        {/* Ïò§Î•∏Ï™Ω: ÌûàÏä§ÌÜ†Î¶¨ ‚Äì Ìà¥ÌåÅÏù¥ Ïù¥ Î≤ÑÌäº Î∞îÎ°ú ÏúÑÏóê Îú∏ */}
                        <div style={{position:'relative'}}>
                            {showHistory && (
                                <>
                                    <div style={{position:'fixed',inset:0,zIndex:190}} onClick={() => setShowHistory(false)} />
                                    <div className="history-tooltip">
                                        {history.length === 0
                                            ? <div className="tooltip-empty">ÏµúÍ∑º Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div>
                                            : history.map((h, i) => (
                                                <div key={i} className="tooltip-item" onClick={() => {
                                                    setOrigin(h.origin); setDestination(h.destination);
                                                    setShowHistory(false);
                                                    setTimeout(() => performCalculation(h.origin, h.destination, true), 0);
                                                }}>
                                                    <div>
                                                        <span style={{fontSize:'13px',fontWeight:700,color:'#1C1C1E'}}>{h.origin}</span>
                                                        <span style={{fontSize:'12px',color:'#8E8E93',margin:'0 4px'}}>‚Üí</span>
                                                        <span style={{fontSize:'13px',fontWeight:700,color:'#8B0000'}}>{h.destination}</span>
                                                    </div>
                                                    <span style={{fontSize:'12px',fontWeight:700,color:'#8B0000',marginLeft:'8px'}}>{fmt(h.cost)}Ïõê</span>
                                                </div>
                                            ))
                                        }
                                    </div>
                                </>
                            )}
                            <button className="nav-btn" onClick={() => setShowHistory(v => !v)}>
                                <Icons.Clock style={{color:'#8B0000', opacity: showHistory ? 1 : 0.7}} />
                            </button>
                        </div>
                    </nav>


                    {showDetail && (
                        <div className="fixed inset-0 z-[130] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in" onClick={() => setShowDetail(false)}>
                            <div className="bg-white w-full max-w-sm rounded-[28px] overflow-hidden animate-slide-up border border-[#8B0000]/10" style={{background: 'linear-gradient(180deg, #FFFFFF 0%, #FAFAFA 100%)', boxShadow: '0 25px 50px rgba(0,0,0,0.25), 0 10px 20px rgba(0,0,0,0.1)'}} onClick={e => e.stopPropagation()}>
                                <div className="p-4 pb-3 flex justify-between items-center border-b border-gray-100">
                                    <h3 className="font-black text-[20px] text-[#1C1C1E] tracking-tight">Ïó¨ÎπÑ ÏÉÅÏÑ∏ Í≥ÑÏÇ∞</h3>
                                    <button onClick={() => setShowDetail(false)} className="text-gray-400 hover:text-[#8B0000] transition-colors"><Icons.X size={22} /></button>
                                </div>
                                
                                <div className="p-4 space-y-3 bg-white">
                                    <div className="relative flex items-center justify-between h-12">
                                        <span className="font-bold text-gray-700 text-[18px] w-24">ÏùºÎπÑ</span>
                                        <button onClick={()=>setActiveModal('daily')} className={`deduct-btn ${deductions.gov_vehicle ? 'active':''}`}>
                                            <span>Í∞êÏï°</span>
                                        </button>
                                        <div className="flex flex-col items-end flex-1"><span className="text-xl font-bold text-[#1C1C1E] font-suit">{fmt(detailCosts.daily)}Ïõê</span>{deductions.gov_vehicle && <span className="text-[11px] text-[#8B0000] font-bold leading-none mt-1">(-12,500)</span>}</div>
                                    </div>
                                    <div className="relative flex items-center justify-between h-12">
                                        <span className="font-bold text-gray-700 text-[18px] w-24">ÏãùÎπÑ</span>
                                        <button onClick={()=>setActiveModal('meal')} className={`deduct-btn ${(deductions.meal_1||deductions.meal_2||deductions.meal_3||deductions.meal_half) ? 'active':''}`}>
                                            <span>Í∞êÏï°</span>
                                        </button>
                                        <div className="flex flex-col items-end flex-1"><span className="text-xl font-bold text-[#1C1C1E] font-suit">{fmt(detailCosts.meal)}Ïõê</span><span className="text-[11px] text-[#8B0000] font-bold leading-none mt-1">{getMealDeductionLabel()}</span></div>
                                    </div>
                                    <div className="pt-4 border-t border-dashed border-gray-200">
                                        <div className="relative flex items-center justify-between h-12">
                                            <div className="flex items-center"><span className="font-bold text-gray-700 text-[18px]">ÍµêÌÜµÎπÑ</span><span className={`tag-side ${getTagStyles('ÏôïÎ≥µ')}`}>ÏôïÎ≥µ</span></div>
                                            <button onClick={()=>setActiveModal('transport')} className={`deduct-btn ${deductions.transport_proof || deductions.transport_gov_vehicle || deductions.transport_passenger ? 'active':''}`}>
                                                <span>Í∞êÏï°</span>
                                            </button>
                                            <div className="text-right flex-1">
                                                {!(deductions.transport_proof || deductions.transport_gov_vehicle || deductions.transport_passenger) ? (
                                                    <div className="flex items-center justify-end gap-1.5">
                                                        <input 
                                                            type="tel" 
                                                            value={manualMainTransport === null || manualMainTransport === 0 ? '' : fmt(manualMainTransport)} 
                                                            onFocus={(e) => e.target.select()}
                                                            onChange={(e) => { 
                                                                const val = e.target.value.replace(/,/g, ''); 
                                                                setManualMainTransport(val === '' ? null : Number(val)); 
                                                            }}
                                                            className="ship-fare-input !py-1.5 !text-[16px]" 
                                                            placeholder="0" 
                                                        />
                                                        <span className="text-xl font-bold text-gray-900">Ïõê</span>
                                                    </div>
                                                ) : <span className="text-xl font-bold text-gray-400">0Ïõê</span>}
                                            </div>
                                        </div>
                                        {(shipFare > 0 || result.isShipOnlyRoute || result.shipCost > 0) && (
                                            <div className="relative flex items-center justify-between h-12 mt-4">
                                                <span className="font-bold text-gray-700 text-[18px]">Í∏∞ÌÉÄÍµêÌÜµÎπÑ</span>
                                                <div className="text-right flex-1">
                                                    <div className="flex items-center justify-end gap-1.5">
                                                        <input 
                                                            type="tel" 
                                                            value={shipFare === 0 ? '' : fmt(shipFare)} 
                                                            onFocus={(e) => e.target.select()}
                                                            onChange={(e) => { 
                                                                const val = e.target.value.replace(/,/g, ''); 
                                                                setShipFare(val === '' ? 0 : Number(val)); 
                                                            }}
                                                            className="ship-fare-input !py-1.5 !text-[16px]" 
                                                            placeholder="0" 
                                                        />
                                                        <span className="text-xl font-bold text-gray-900">Ïõê</span>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    <div className="pt-3 border-t-2 border-gray-200 flex justify-between items-center"><span className="font-bold text-[#1C1C1E] text-[18px]">Ìï©Í≥Ñ</span><span className="text-[28px] font-black text-[#8B0000] font-suit">{fmt(detailCosts.total)}<span className="text-[18px] ml-1.5">Ïõê</span></span></div>
                                    
                                    {/* ÌôïÏù∏ Î≤ÑÌäº: ÎÖ∏ÎûÄÏÉâ Î∞∞Í≤Ω ‚Üí ÌÅ¥Î¶≠ Ïãú Ìù∞ÏÉâ Î∞òÏ†Ñ */}
                                    <button onClick={() => setShowDetail(false)} className="w-full mt-4 h-12 rounded-[20px] font-bold text-[18px] confirm-btn-yellow">ÌôïÏù∏</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Í¥ÄÎÇ¥ Ïó¨ÎπÑ ÌåùÏóÖ */}
                    {intraCityOpen && (
                        <div className="fixed inset-0 z-[110] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in" onClick={() => setIntraCityOpen(false)}>
                            <div className="bg-white w-full max-w-sm rounded-[28px] overflow-hidden animate-slide-up" style={{background: 'linear-gradient(180deg, #FFFFFF 0%, #FAFAFA 100%)', boxShadow: '0 25px 50px rgba(0,0,0,0.25), 0 10px 20px rgba(0,0,0,0.1)'}} onClick={e => e.stopPropagation()}>
                                <div className="p-5">
                                    <div className="flex justify-between items-center mb-4"><h3 className="font-bold text-[20px] text-[#1C1C1E]">Í¥ÄÎÇ¥ Ïó¨ÎπÑ</h3><button onClick={() => setIntraCityOpen(false)} className="text-gray-400 hover:text-gray-600 transition-colors"><Icons.X size={22} /></button></div>
                                    <div className="mb-4 p-3 bg-[#F8F9FA] rounded-xl border border-gray-200 text-[13px] font-medium text-gray-700 leading-relaxed break-keep shadow-inner">Í∑ºÎ¨¥ÏßÄ ÎÇ¥Ïùò Ï∂úÏû•ÏùÄ Î≥ÑÎèÑÏùò ÏòÅÏàòÏ¶ù Ï¶ùÎπô ÏóÜÏù¥ Ï†ïÏï° ÏßÄÍ∏âÎê©ÎãàÎã§.</div>
                                    <div className="space-y-4 border-t border-b border-gray-100 py-4">
                                        <div className="flex justify-between items-center"><span className="text-[16px] font-bold text-gray-800">4ÏãúÍ∞Ñ ÎØ∏Îßå</span><Toggle checked={intraDeductions.shortTime} onChange={(val) => setIntraDeductions(p => ({...p, shortTime: val}))} /></div>
                                        <div className="flex justify-between items-center"><span className="text-[16px] font-bold text-gray-800">Í¥ÄÏö©Ï∞®Îüâ Ïù¥Ïö©</span><Toggle checked={intraDeductions.govVehicle} onChange={(val) => setIntraDeductions(p => ({...p, govVehicle: val}))} /></div>
                                    </div>
                                    <div className="mt-4 flex justify-between items-center"><span className="text-[18px] font-bold text-[#1C1C1E]">ÏßÄÍ∏âÏï°</span><span className="text-[24px] font-black text-[#8B0000] font-suit">{fmt(20000 - (intraDeductions.shortTime ? 10000 : 0) - (intraDeductions.govVehicle ? 10000 : 0))}Ïõê</span></div>
                                    <button onClick={() => setIntraCityOpen(false)} className="w-full mt-5 h-12 rounded-[20px] font-bold text-[17px] transition-all border border-[#E5E0D6] text-[#8B0000]" style={{background: 'linear-gradient(180deg, #F7F2E8 0%, #F5F0E6 50%, #EDE8DE 100%)', boxShadow: '0 2px 4px rgba(0,0,0,0.04), inset 0 1px 0 rgba(255,255,255,0.8)'}}>Îã´Í∏∞</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Í∞êÏï° ÏÇ¨Ïú† Î™®Îã¨ */}
                    {activeModal && (() => {
                        const content = getModalContent(activeModal);
                        return (
                            <div className="fixed inset-0 z-[140] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in" onClick={() => setActiveModal(null)}>
                                <div className="bg-white w-full max-w-sm rounded-[28px] animate-in zoom-in-95 overflow-hidden border border-[#F5A623]/30" style={{background: 'linear-gradient(180deg, #FFFFFF 0%, #FAFAFA 100%)', boxShadow: '0 25px 50px rgba(0,0,0,0.25), 0 10px 20px rgba(0,0,0,0.1)'}} onClick={e => e.stopPropagation()}>
                                    <div className="p-4 max-h-[85vh] overflow-y-auto custom-scroll">
                                        <div className="flex justify-between items-center mb-3"><h3 className="text-[18px] font-bold text-[#1C1C1E]">{content.title}</h3><button onClick={()=>setActiveModal(null)}><Icons.X size={22} className="text-gray-400 hover:text-gray-600 transition-colors"/></button></div>
                                        <p className="text-[13px] text-gray-600 font-medium leading-relaxed mb-4 break-keep font-pretendard">{content.desc}</p>
                                        {activeModal === 'meal' && (
                                            <div className="mb-4 space-y-2">
                                                <div className="p-3 bg-[#FFFBEB] rounded-xl border border-[#FDE68A]">
                                                    <p className="text-[13px] font-bold text-[#D97706] mb-1">üí° Í∞êÏï° ÏÇ¨Ïú†</p>
                                                    <ul className="text-[12px] text-[#B45309] space-y-1 list-disc pl-4 leading-snug break-keep">
                                                        <li>Ï£ºÏµú Ï∏°¬∑Ï¥àÏ≤≠Í∏∞Í¥ÄÏóêÏÑú ÏãùÏÇ¨Î•º Ï†úÍ≥µÌïú Í≤ΩÏö∞</li>
                                                        <li>ÏóÖÎ¨¥Ï∂îÏßÑÎπÑ(Î≤ïÏù∏Ïπ¥Îìú)Î°ú ÏãùÏÇ¨Î•º Ìï¥Í≤∞Ìïú Í≤ΩÏö∞</li>
                                                        <li>Í¥ÄÎÇ¥¬∑Í¥ÄÏô∏Ï∂úÏû• Ï§ëÎ≥µÎêêÏùÑ Îïå (ÏãùÏÇ¨ÏãúÍ∞Ñ Í∏∞Ï§Ä)</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        )}
                                        {activeModal === 'transport' && (
                                            <div className="mb-4 space-y-2">
                                                <div className="p-3 bg-[#F8F9FA] rounded-xl border border-gray-200">
                                                    <p className="text-[13px] font-bold text-[#1C1C1E] mb-1">üìÑ Ïã§ÎπÑ Ï†ïÏÇ∞ Î∞è Ï¶ùÍ±∞ÏÑúÎ•ò ÏïàÎÇ¥</p>
                                                    <ul className="text-[12px] text-gray-600 space-y-1 list-disc pl-4 leading-snug break-keep">
                                                        <li><strong>Ï†ïÏï° ÏßÄÍ∏âÍ≥º Îã¨Î¶¨ Ïã§ÎπÑ Ï†ïÏÇ∞ ÏõêÏπô</strong></li>
                                                        <li>Í≤∞Ï†úÎÇ¥Ïó≠Ïù¥ ÌôïÏù∏ÎêòÎäî Ï¶ùÍ±∞ÏÑúÎ•ò ÌïÑÏàò</li>
                                                        <li>ÏòàÏãú: Ï£ºÏú†ÏòÅÏàòÏ¶ù, ÌÜ®Í≤åÏù¥Ìä∏ ÏòÅÏàòÏ¶ù Îì±</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        )}
                                        <div className="space-y-2">{content.items.map(item => (<div key={item.id} className="flex justify-between items-center py-4 border-t border-gray-100"><div><span className="block text-[15px] font-bold text-gray-800 leading-snug">{item.label}</span>{item.subLabel && <span className="text-[12px] text-gray-500 font-bold mt-0.5 block">{item.subLabel}</span>}</div><Toggle checked={deductions[item.id]} onChange={() => setDeductions(prev => { 
                                            const newState = { ...prev }; 
                                            if (['meal_1','meal_2','meal_3','meal_half'].includes(item.id)) { if(!prev[item.id]) ['meal_1','meal_2','meal_3','meal_half'].forEach(k=>newState[k]=false); } 
                                            newState[item.id] = !prev[item.id]; 
                                            if (item.id === 'gov_vehicle') { newState['transport_gov_vehicle'] = newState[item.id]; }
                                            if (item.id === 'transport_gov_vehicle') { newState['gov_vehicle'] = newState[item.id]; }
                                            return newState; 
                                        })} /></div>))}</div>
                                        <button onClick={()=>setActiveModal(null)} className="w-full mt-4 h-12 rounded-[20px] font-bold text-[17px] transition-all border border-[#E5E0D6] text-[#8B0000]" style={{background: 'linear-gradient(180deg, #F7F2E8 0%, #F5F0E6 50%, #EDE8DE 100%)', boxShadow: '0 2px 4px rgba(0,0,0,0.04), inset 0 1px 0 rgba(255,255,255,0.8)'}}>ÌôïÏù∏</button>
                                    </div>
                                </div>
                            </div>
                        );
                    })()}

                    {/* ÏÑ∏Î∂Ä ÏßÄÏó≠ ÏÑ†ÌÉù Î™®Îã¨ */}
                    {modalState.type && (
                        <div className="fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in" onClick={() => { setModalState({ type: null, data: [] }); setTimeout(() => performCalculation(origin, destination, true), 0); }}>
                            <div className="bg-white rounded-[28px] w-full max-w-sm shadow-2xl overflow-hidden animate-in zoom-in-95" onClick={e => e.stopPropagation()}>
                                <div style={{background: 'linear-gradient(180deg, #9B1111 0%, #8B0000 100%)'}} className="p-5 text-white flex justify-between items-center font-bold text-[18px] font-suit">ÏÑ∏Î∂Ä ÏßÄÏó≠ ÏÑ†ÌÉù<button onClick={() => { setModalState({ type: null, data: [] }); setTimeout(() => performCalculation(origin, destination, true), 0); }} className="hover:opacity-70 transition-opacity"><Icons.X size={22} /></button></div>
                                <div className="p-5 max-h-[60vh] overflow-y-auto custom-scroll">
                                    <div className="grid grid-cols-3 gap-3">
                                        {modalState.data.map((name) => (
                                            <button key={name} onClick={() => { if (modalState.type === 'origin') setOrigin(name); else setDestination(name); setModalState({ type: null, data: [] }); setTimeout(() => performCalculation(modalState.type === 'origin' ? name : origin, modalState.type === 'destination' ? name : destination, true), 0); }} className="flex flex-col items-center justify-center gap-1.5 px-2 py-4 rounded-[16px] bg-[#F8F9FA] border border-transparent transition-all hover:bg-white hover:border-[#F5A623] hover:shadow-[0_4px_12px_rgba(245,166,35,0.15)] active:scale-95 outline-none"><span className="text-[26px]">{REGION_ICONS[name.replace(/\s/g, "")]}</span><span className="text-[13px] font-bold text-gray-700 text-center font-pretendard">{name}</span></button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
